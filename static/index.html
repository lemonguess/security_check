<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¿åºœç½‘ç«™å†…å®¹å®¡æ ¸ç³»ç»Ÿ - æ¼”ç¤ºé¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .demo-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            background: #fafafa;
        }
        
        .demo-section h2 {
            color: #c41e3a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #c41e3a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
            font-family: monospace;
        }
        
        .input-group textarea:focus {
            outline: none;
            border-color: #c41e3a;
        }
        
        .input-group input[type="text"], .input-group input[type="url"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input[type="text"]:focus, .input-group input[type="url"]:focus {
            outline: none;
            border-color: #c41e3a;
        }
        
        .btn {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(196, 30, 58, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.3);
        }
        
        .result-panel {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #c41e3a;
        }
        
        .result-panel h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .risk-safe {
            background: #d4edda;
            color: #155724;
        }
        
        .risk-suspicious {
            background: #fff3cd;
            color: #856404;
        }
        
        .risk-risky {
            background: #f8d7da;
            color: #721c24;
        }
        
        .risk-blocked {
            background: #f5c6cb;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #c41e3a;
            display: block;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #c41e3a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .gov-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .example-btn {
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 14px;
        }
        
        .example-btn:hover {
            background: #e9ecef;
            border-color: #c41e3a;
        }
        
        .example-btn.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            color: #c41e3a;
            border-bottom-color: #c41e3a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            align-items: end;
        }
        
        .url-input-group .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .content-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: white;
        }
        
        .content-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-item:last-child {
            border-bottom: none;
        }
        
        .content-item-text {
            flex: 1;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .content-item-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .batch-result {
            margin-top: 20px;
        }
        
        .batch-result-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #c41e3a;
            background: #f8f9fa;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            transition: width 0.3s;
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ æ”¿åºœç½‘ç«™å†…å®¹å®¡æ ¸ç³»ç»Ÿ</h1>
            <p>ä¸“ä¸ºæ”¿åºœå®˜ç½‘å†…å®¹ç›‘ç®¡è®¾è®¡çš„AIæ™ºèƒ½å®¡æ ¸å¹³å°</p>
        </div>
        
        <div class="content">
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="demo-section">
                <h2>ğŸ“Š ç³»ç»Ÿè¿è¡ŒçŠ¶æ€</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalRequests">-</span>
                        <div class="stat-label">æ€»å®¡æ ¸è¯·æ±‚</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="successRate">-</span>
                        <div class="stat-label">å®¡æ ¸æˆåŠŸç‡</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="avgTime">-</span>
                        <div class="stat-label">å¹³å‡å¤„ç†æ—¶é—´</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="todayCount">-</span>
                        <div class="stat-label">ä»Šæ—¥å®¡æ ¸é‡</div>
                    </div>
                </div>
            </div>
            
            <!-- å†…å®¹å®¡æ ¸ -->
            <div class="demo-section">
                <h2>ğŸ” æ”¿åºœç½‘ç«™å†…å®¹å®¡æ ¸</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('url')">ğŸ“‹ ç½‘é¡µå†…å®¹æŠ“å–</div>
                    <div class="tab" onclick="switchTab('single')">ğŸ“ å•æ¡å†…å®¹å®¡æ ¸</div>
                    <div class="tab" onclick="switchTab('batch')">ğŸ“¦ æ‰¹é‡å†…å®¹å®¡æ ¸</div>
                </div>
                
                <!-- ç½‘é¡µå†…å®¹æŠ“å– -->
                <div id="urlTab" class="tab-content active">
                                         <div class="gov-examples">
                         <button class="example-btn" onclick="setExampleUrl('http://sc.tobacco.gov.cn/news/shizhengyaowen')">
                             ğŸš¬ çƒŸè‰å±€æ—¶æ”¿è¦é—»
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/pushinfo/v150203/index.htm')">
                             ğŸ›ï¸ å›½åŠ¡é™¢ä¿¡æ¯é¡µé¢
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/xinwen/index.htm')">
                             ğŸ“° æ”¿åºœæ–°é—»é¡µé¢
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/zhengce/index.htm')">
                             ğŸ“œ æ”¿ç­–æ–‡ä»¶é¡µé¢
                         </button>
<!--                         <button class="example-btn" onclick="testScrapingStrategies()">-->
<!--                             ğŸ§ª æµ‹è¯•æŠ“å–ç­–ç•¥-->
<!--                         </button>-->
                     </div>
                    
                    <div class="url-input-group">
                                                 <div class="input-group">
                             <label for="urlInput">ç›®æ ‡URLåœ°å€ï¼š</label>
                             <input type="url" id="urlInput" placeholder="è¯·è¾“å…¥æ”¿åºœç½‘ç«™URLï¼Œå¦‚ï¼šhttp://sc.tobacco.gov.cn/news/shizhengyaowen" value="http://sc.tobacco.gov.cn/news/shizhengyaowen">
                         </div>
                        <button class="btn" onclick="fetchUrlContent()" id="fetchBtn">
                            ğŸ”— æŠ“å–å†…å®¹
                        </button>
                    </div>
                    
                    <!-- æŠ“å–çš„å†…å®¹åˆ—è¡¨ -->
                    <div id="contentListContainer" style="display: none;">
                        <h4>ğŸ“‹ æŠ“å–åˆ°çš„å†…å®¹åˆ—è¡¨ï¼š</h4>
                        <div class="content-list" id="contentList">
                            <!-- åŠ¨æ€ç”Ÿæˆçš„å†…å®¹åˆ—è¡¨ -->
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="auditAllContent()">ğŸ” å…¨éƒ¨å®¡æ ¸</button>
                            <button class="btn btn-secondary" onclick="auditSelectedContent()">ğŸ¯ å®¡æ ¸é€‰ä¸­é¡¹</button>
                            <button class="btn btn-secondary" onclick="exportResults()">ğŸ“Š å¯¼å‡ºç»“æœ</button>
                        </div>
                        
                        <!-- æ‰¹é‡å®¡æ ¸è¿›åº¦ -->
                        <div id="batchProgress" style="display: none;">
                            <h4>å®¡æ ¸è¿›åº¦ï¼š</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <p id="progressText">å‡†å¤‡å¼€å§‹...</p>
                        </div>
                    </div>
                </div>
                
                <!-- å•æ¡å®¡æ ¸ -->
                <div id="singleTab" class="tab-content">
                                         <div class="gov-examples">
                         <button class="example-btn" onclick="setExample('å››å·çœçƒŸè‰ä¸“å–å±€ï¼ˆå…¬å¸ï¼‰å¬å¼€2024å¹´åº¦å·¥ä½œä¼šè®®')">
                             ğŸš¬ çƒŸè‰å±€æ–°é—»
                         </button>
                         <button class="example-btn" onclick="setExample('æ·±å…¥å­¦ä¹ è´¯å½»å…šçš„äºŒåå¤§ç²¾ç¥ æ¨åŠ¨çƒŸè‰è¡Œä¸šé«˜è´¨é‡å‘å±•')">
                             ğŸ“œ æ”¿ç­–å­¦ä¹ 
                         </button>
                         <button class="example-btn" onclick="setExample('çœçƒŸè‰å±€é¢†å¯¼è°ƒç ”å·¥ä½œï¼Œè”ç³»ç”µè¯ï¼š028-12345678ï¼Œé‚®ç®±ï¼šadmin@tobacco.gov.cn')">
                             ğŸ“ åŒ…å«è”ç³»æ–¹å¼
                         </button>
                         <button class="example-btn" onclick="setExample('è¿™ä¸ªçƒŸè‰æ”¿ç­–å®Œå…¨ä¸åˆç†ï¼Œçº¯ç²¹æ˜¯åˆ©ç›Šé©±åŠ¨ï¼')">
                             ğŸ’¢ è´Ÿé¢è¯„è®ºæµ‹è¯•
                         </button>
                     </div>
                    
                    <div class="input-group">
                        <label for="contentInput">å¾…å®¡æ ¸å†…å®¹ï¼š</label>
                        <textarea id="contentInput" placeholder="è¯·è¾“å…¥è¦å®¡æ ¸çš„æ”¿åºœç½‘ç«™å†…å®¹..."></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label for="contentId">å†…å®¹IDï¼ˆå¯é€‰ï¼‰ï¼š</label>
                        <input type="text" id="contentId" placeholder="ä¾‹å¦‚ï¼šgov_content_001">
                    </div>
                    
                    <button class="btn" onclick="moderateContent()" id="moderateBtn">
                        ğŸš€ å¼€å§‹å®¡æ ¸
                    </button>
                </div>
                
                <!-- æ‰¹é‡å®¡æ ¸ -->
                <div id="batchTab" class="tab-content">
                    <div class="input-group">
                        <label for="batchContent">æ‰¹é‡å†…å®¹ï¼ˆæ¯è¡Œä¸€æ¡ï¼‰ï¼š</label>
                                                 <textarea id="batchContent" placeholder="è¯·è¾“å…¥å¤šæ¡æ”¿åºœç½‘ç«™å†…å®¹ï¼Œæ¯è¡Œä¸€æ¡...
ç¤ºä¾‹ï¼š
å››å·çœçƒŸè‰ä¸“å–å±€ï¼ˆå…¬å¸ï¼‰å¬å¼€2024å¹´åº¦å·¥ä½œä¼šè®®
æ·±å…¥å­¦ä¹ è´¯å½»å…šçš„äºŒåå¤§ç²¾ç¥ æ¨åŠ¨çƒŸè‰è¡Œä¸šé«˜è´¨é‡å‘å±•
å››å·çƒŸè‰ç³»ç»Ÿç§¯æå¼€å±•å…šå²å­¦ä¹ æ•™è‚²å®è·µæ´»åŠ¨
è”ç³»æˆ‘ä»¬ï¼š028-12345678
è¿™ä¸ªçƒŸè‰æ”¿ç­–æœ‰é—®é¢˜ï¼Œéœ€è¦é‡æ–°è€ƒè™‘"></textarea>
                    </div>
                    
                    <button class="btn" onclick="moderateBatch()" id="batchBtn">
                        ğŸ“¦ æ‰¹é‡å®¡æ ¸
                    </button>
                </div>
                
                <!-- åŠ è½½çŠ¶æ€ -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
                
                <!-- ç»“æœæ˜¾ç¤º -->
                <div class="result-panel" id="resultPanel" style="display: none;">
                    <h3>ğŸ“‹ å®¡æ ¸ç»“æœæŠ¥å‘Š</h3>
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // const API_BASE = 'http://localhost:8000';
        const API_BASE = `${window.location.protocol}//${window.location.host}`;
        let fetchedContentList = [];
        let selectedContent = new Set();
        
        // åˆå§‹åŒ–é¡µé¢
        window.onload = function() {
            loadStats();
            generateContentId();
        };
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;
            
            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
            const colors = {
                'success': '#28a745',
                'warning': '#ffc107',
                'error': '#dc3545',
                'info': '#17a2b8'
            };
            notification.style.backgroundColor = colors[type] || colors.info;
            
            notification.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ·»åŠ activeç±»
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            // ç‰¹æ®Šå¤„ç†æµ‹è¯•æŠ“å–ç­–ç•¥æŒ‰é’®
            const testStrategyButton = document.querySelector('button[onclick="testScrapingStrategies()"]');
            if (testStrategyButton && event.target !== testStrategyButton) {
                testStrategyButton.style.borderBottomColor = ''; // æ¢å¤é»˜è®¤è¾¹æ¡†é¢œè‰²
            }
        }

        // æµ‹è¯•æŠ“å–ç­–ç•¥
        async function testScrapingStrategies() {
            showNotification('æ­£åœ¨æµ‹è¯•ä¸åŒçš„æŠ“å–ç­–ç•¥...', 'info');
            
            try {
                // æµ‹è¯•çƒŸè‰å±€APIè¿æ¥
                const testResponse = await fetch(`${API_BASE}/api/v1/test-tobacco`);
                const testResult = await testResponse.json();
                
                let strategyInfo = '';
                if (testResult.success) {
                    strategyInfo = 'âœ… çœŸå®APIå¯ç”¨\n';
                } else {
                    strategyInfo = 'âŒ çœŸå®APIä¸å¯ç”¨\n';
                }
                
                // æµ‹è¯•æŠ“å–åŠŸèƒ½
                const scrapeResponse = await fetch(`${API_BASE}/api/v1/scrape`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: 'http://sc.tobacco.gov.cn/news/shizhengyaowen',
                        max_items: 3,
                        content_type: 'news'
                    })
                });
                
                const scrapeResult = await scrapeResponse.json();
                if (scrapeResult.success && scrapeResult.data.length > 0) {
                    const firstItem = scrapeResult.data[0];
                    if (firstItem.id.startsWith('enhanced_mock_')) {
                        strategyInfo += 'ğŸ¯ å½“å‰ä½¿ç”¨ï¼šæ™ºèƒ½æ¨¡æ‹Ÿæ•°æ®\n';
                        strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šé«˜ï¼ˆåŸºäºçœŸå®æ–°é—»æ¨¡æ¿ï¼‰\n';
                        strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šå¿«\n';
                        strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šåŠ¨æ€ç”Ÿæˆ';
                    } else if (firstItem.id.startsWith('web_')) {
                        strategyInfo += 'ğŸŒ å½“å‰ä½¿ç”¨ï¼šç½‘é¡µæŠ“å–\n';
                        strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šä¸­ï¼ˆä¾èµ–ç½‘é¡µç»“æ„ï¼‰\n';
                        strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šä¸­ç­‰\n';
                        strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šå®æ—¶';
                    } else if (firstItem.id.startsWith('tobacco_')) {
                        strategyInfo += 'ğŸ¯ å½“å‰ä½¿ç”¨ï¼šçœŸå®API\n';
                        strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šæœ€é«˜ï¼ˆå®˜æ–¹æ•°æ®ï¼‰\n';
                        strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šå¿«\n';
                        strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šå®æ—¶';
                    }
                }
                
                // æ˜¾ç¤ºç­–ç•¥ä¿¡æ¯
                alert(`æŠ“å–ç­–ç•¥æµ‹è¯•ç»“æœï¼š\n\n${strategyInfo}`);
                
            } catch (error) {
                showNotification('ç­–ç•¥æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
            }

            // è®¾ç½®æµ‹è¯•æŠ“å–ç­–ç•¥æŒ‰é’®ä¸ºé€‰ä¸­çŠ¶æ€
            const testStrategyButton = document.querySelector('button[onclick="testScrapingStrategies()"]');
            if (testStrategyButton) {
                testStrategyButton.style.borderBottomColor = '#c41e3a'; // è®¾ç½®è“è‰²è¾¹æ¡†
            }
        }
        
                 // è®¾ç½®ç¤ºä¾‹URL
         function setExampleUrl(url) {
             document.getElementById('urlInput').value = url;
             // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
             document.querySelectorAll('.example-btn').forEach(btn => btn.classList.remove('active'));
             // ç»™å½“å‰ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ activeç±»
             event.target.classList.add('active');
         }
         
         // æµ‹è¯•æŠ“å–ç­–ç•¥
         async function testScrapingStrategies() {
             // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
             document.querySelectorAll('.example-btn').forEach(btn => btn.classList.remove('active'));
             // ç»™å½“å‰ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ activeç±»
             event.target.classList.add('active');
             
             showNotification('æ­£åœ¨æµ‹è¯•ä¸åŒçš„æŠ“å–ç­–ç•¥...', 'info');
             
             try {
                 // æµ‹è¯•çƒŸè‰å±€APIè¿æ¥
                 const testResponse = await fetch(`${API_BASE}/api/v1/test-tobacco`);
                 const testResult = await testResponse.json();
                 
                 let strategyInfo = '';
                 if (testResult.success) {
                     strategyInfo = 'âœ… çœŸå®APIå¯ç”¨\n';
                 } else {
                     strategyInfo = 'âŒ çœŸå®APIä¸å¯ç”¨\n';
                 }
                 
                 // æµ‹è¯•æŠ“å–åŠŸèƒ½
                 const scrapeResponse = await fetch(`${API_BASE}/api/v1/scrape`, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({
                         url: 'http://sc.tobacco.gov.cn/news/shizhengyaowen',
                         max_items: 3,
                         content_type: 'news'
                     })
                 });
                 
                 const scrapeResult = await scrapeResponse.json();
                 if (scrapeResult.success && scrapeResult.data.length > 0) {
                     const firstItem = scrapeResult.data[0];
                     if (firstItem.id.startsWith('enhanced_mock_')) {
                         strategyInfo += 'ğŸ¯ å½“å‰ä½¿ç”¨ï¼šæ™ºèƒ½æ¨¡æ‹Ÿæ•°æ®\n';
                         strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šé«˜ï¼ˆåŸºäºçœŸå®æ–°é—»æ¨¡æ¿ï¼‰\n';
                         strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šå¿«\n';
                         strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šåŠ¨æ€ç”Ÿæˆ';
                     } else if (firstItem.id.startsWith('web_')) {
                         strategyInfo += 'ğŸŒ å½“å‰ä½¿ç”¨ï¼šç½‘é¡µæŠ“å–\n';
                         strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šä¸­ï¼ˆä¾èµ–ç½‘é¡µç»“æ„ï¼‰\n';
                         strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šä¸­ç­‰\n';
                         strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šå®æ—¶';
                     } else if (firstItem.id.startsWith('tobacco_')) {
                         strategyInfo += 'ğŸ¯ å½“å‰ä½¿ç”¨ï¼šçœŸå®API\n';
                         strategyInfo += 'ğŸ“Š æ•°æ®è´¨é‡ï¼šæœ€é«˜ï¼ˆå®˜æ–¹æ•°æ®ï¼‰\n';
                         strategyInfo += 'âš¡ å“åº”é€Ÿåº¦ï¼šå¿«\n';
                         strategyInfo += 'ğŸ”„ æ•°æ®æ›´æ–°ï¼šå®æ—¶';
                     }
                 }
                 
                 // æ˜¾ç¤ºç­–ç•¥ä¿¡æ¯
                 alert(`æŠ“å–ç­–ç•¥æµ‹è¯•ç»“æœï¼š\n\n${strategyInfo}`);
                 
             } catch (error) {
                 showNotification('ç­–ç•¥æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
             }
         }
         
         // ä»å†…å®¹ä¸­æå–åª’ä½“æ–‡ä»¶URL
         function extractMediaFromContent(content) {
             const mediaFiles = [];
             
             // å›¾ç‰‡URLæ­£åˆ™åŒ¹é…
             const imageRegex = /(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|bmp|webp|svg))/gi;
             const imageMatches = content.match(imageRegex) || [];
             
             // è§†é¢‘URLæ­£åˆ™åŒ¹é…
             const videoRegex = /(https?:\/\/[^\s]+\.(?:mp4|avi|mov|wmv|flv|webm|mkv))/gi;
             const videoMatches = content.match(videoRegex) || [];
             
             // æ¨¡æ‹Ÿä¸€äº›åª’ä½“æ–‡ä»¶ï¼ˆå› ä¸ºæ ‡é¢˜é€šå¸¸ä¸åŒ…å«åª’ä½“URLï¼‰
             if (content.includes('å·¥ä½œä¼šè®®') || content.includes('å­¦ä¹ ')) {
                 // æ¨¡æ‹Ÿä¼šè®®ç›¸å…³çš„å›¾ç‰‡å’Œè§†é¢‘
                 mediaFiles.push({
                     url: 'https://example.com/meeting_photo.jpg',
                     type: 'image',
                     status: 'pending'
                 });
                 if (Math.random() > 0.7) {
                     mediaFiles.push({
                         url: 'https://example.com/meeting_video.mp4',
                         type: 'video',
                         status: 'pending'
                     });
                 }
             }
             
             if (content.includes('å…šçš„') || content.includes('ç²¾ç¥')) {
                 // æ¨¡æ‹Ÿå…šå»ºç›¸å…³çš„å›¾ç‰‡
                 mediaFiles.push({
                     url: 'https://example.com/party_banner.png',
                     type: 'image',
                     status: 'pending'
                 });
             }
             
             // å¤„ç†å®é™…åŒ¹é…çš„å›¾ç‰‡
             imageMatches.forEach(url => {
                 mediaFiles.push({
                     url: url,
                     type: 'image',
                     status: 'pending'
                 });
             });
             
             // å¤„ç†å®é™…åŒ¹é…çš„è§†é¢‘
             videoMatches.forEach(url => {
                 mediaFiles.push({
                     url: url,
                     type: 'video', 
                     status: 'pending'
                 });
             });
             
             return mediaFiles;
         }
         
         // å®¡æ ¸åª’ä½“æ–‡ä»¶
         async function moderateMediaFiles(mediaFiles) {
             if (!mediaFiles || mediaFiles.length === 0) {
                 return [];
             }
             
             try {
                 // åˆ†åˆ«å¤„ç†å›¾ç‰‡å’Œè§†é¢‘
                 const imageUrls = mediaFiles.filter(file => file.type === 'image').map(file => file.url);
                 const videoUrls = mediaFiles.filter(file => file.type === 'video').map(file => file.url);
                 
                 const results = [];
                 
                 // å®¡æ ¸å›¾ç‰‡
                 if (imageUrls.length > 0) {
                     const imageResults = await moderateImages(imageUrls);
                     results.push(...imageResults);
                 }
                 
                 // å®¡æ ¸è§†é¢‘
                 if (videoUrls.length > 0) {
                     const videoResults = await moderateVideos(videoUrls);
                     results.push(...videoResults);
                 }
                 
                 return results;
                 
             } catch (error) {
                 console.error('åª’ä½“æ–‡ä»¶å®¡æ ¸å¤±è´¥:', error);
                 return mediaFiles.map(file => ({
                     url: file.url,
                     type: file.type,
                     status: 'error',
                     error: error.message
                 }));
             }
         }
         
         // å®¡æ ¸å›¾ç‰‡ï¼ˆæ¨¡æ‹ŸAPIï¼‰
         async function moderateImages(imageUrls) {
             // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
             await new Promise(resolve => setTimeout(resolve, 500));
             
             return imageUrls.map(url => {
                 // æ¨¡æ‹Ÿå®¡æ ¸ç»“æœ
                 const isRisky = Math.random() > 0.8; // 20%æ¦‚ç‡æœ‰é£é™©
                 const confidence = 0.7 + Math.random() * 0.3; // 70-100%ç½®ä¿¡åº¦
                 
                 return {
                     url: url,
                     type: 'image',
                     status: 'completed',
                     risk_level: isRisky ? 'RISKY' : 'SAFE',
                     confidence: confidence,
                     details: {
                         detected_objects: isRisky ? ['è¿è§„å†…å®¹'] : ['æ­£å¸¸å›¾ç‰‡'],
                         processing_time: 0.3 + Math.random() * 0.5
                     }
                 };
             });
         }
         
         // å®¡æ ¸è§†é¢‘ï¼ˆæ¨¡æ‹ŸAPIï¼‰
         async function moderateVideos(videoUrls) {
             // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿï¼ˆè§†é¢‘å¤„ç†æ›´æ…¢ï¼‰
             await new Promise(resolve => setTimeout(resolve, 1000));
             
             return videoUrls.map(url => {
                 // æ¨¡æ‹Ÿå®¡æ ¸ç»“æœ
                 const isRisky = Math.random() > 0.9; // 10%æ¦‚ç‡æœ‰é£é™©
                 const confidence = 0.6 + Math.random() * 0.4; // 60-100%ç½®ä¿¡åº¦
                 
                 return {
                     url: url,
                     type: 'video',
                     status: 'completed',
                     risk_level: isRisky ? 'SUSPICIOUS' : 'SAFE',
                     confidence: confidence,
                     details: {
                         duration: Math.floor(30 + Math.random() * 300), // 30-330ç§’
                         frame_count: Math.floor(900 + Math.random() * 9000),
                         processing_time: 2.0 + Math.random() * 3.0
                     }
                 };
             });
         }
        
        // è®¾ç½®ç¤ºä¾‹å†…å®¹
        function setExample(content) {
            document.getElementById('contentInput').value = content;
        }
        
        // ç”Ÿæˆéšæœºå†…å®¹ID
        function generateContentId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            document.getElementById('contentId').value = `gov_${timestamp}_${random}`;
        }
        
        // æŠ“å–URLå†…å®¹
        async function fetchUrlContent() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€');
                return;
            }
            
            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.disabled = true;
            fetchBtn.textContent = 'ğŸ”„ æŠ“å–ä¸­...';
            
            try {
                // è°ƒç”¨åç«¯çœŸå®æŠ“å–API
                const response = await fetch(`${API_BASE}/api/v1/scrape`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        max_items: 15,
                        content_type: 'news'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // è½¬æ¢APIè¿”å›çš„æ•°æ®æ ¼å¼
                    fetchedContentList = result.data.map((item, index) => {
                        return {
                            id: item.id || `content_${index}`,
                            text: item.title,
                            content: item.content,
                            url: item.url,
                            type: 'æ ‡é¢˜',
                            status: 'pending',
                            mediaFiles: item.media_files || [],
                            publishDate: item.publish_date,
                            author: item.author,
                            sourceUrl: item.source_url
                        };
                    });
                    
                    displayContentList();
                    
                    // æ˜¾ç¤ºæŠ“å–æˆåŠŸä¿¡æ¯
                    const message = result.message || `æˆåŠŸæŠ“å–åˆ° ${result.data.length} æ¡å†…å®¹`;
                    
                    // æ£€æµ‹æ•°æ®æ¥æºå¹¶æ˜¾ç¤ºç›¸åº”æç¤º
                    const firstItem = result.data[0];
                    let sourceInfo = '';
                    if (firstItem && firstItem.id) {
                        if (firstItem.id.startsWith('enhanced_mock_')) {
                            sourceInfo = 'ï¼ˆä½¿ç”¨æ™ºèƒ½æ¨¡æ‹Ÿæ•°æ® - ç½‘ç»œè¿æ¥å—é™ï¼‰';
                        } else if (firstItem.id.startsWith('web_')) {
                            sourceInfo = 'ï¼ˆé€šè¿‡ç½‘é¡µæŠ“å–è·å–ï¼‰';
                        } else if (firstItem.id.startsWith('tobacco_')) {
                            sourceInfo = 'ï¼ˆé€šè¿‡çœŸå®APIè·å–ï¼‰';
                        }
                    }
                    
                    showNotification(message + sourceInfo, 'success');
                    
                } else {
                    throw new Error(result.message || 'æŠ“å–å¤±è´¥');
                }
                
            } catch (error) {
                console.error('æŠ“å–å¤±è´¥:', error);
                
                // å¦‚æœAPIå¤±è´¥ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®
                console.log('APIæŠ“å–å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®');
                let mockContent = [];
                
                if (url.includes('sc.tobacco.gov.cn')) {
                    // å››å·çƒŸè‰å±€æ—¶æ”¿è¦é—»æ¨¡æ‹Ÿå†…å®¹
                    mockContent = [
                        'å››å·çœçƒŸè‰ä¸“å–å±€ï¼ˆå…¬å¸ï¼‰å¬å¼€2024å¹´åº¦å·¥ä½œä¼šè®®',
                        'æ·±å…¥å­¦ä¹ è´¯å½»å…šçš„äºŒåå¤§ç²¾ç¥ æ¨åŠ¨çƒŸè‰è¡Œä¸šé«˜è´¨é‡å‘å±•',
                        'å››å·çƒŸè‰ç³»ç»Ÿç§¯æå¼€å±•å…šå²å­¦ä¹ æ•™è‚²å®è·µæ´»åŠ¨',
                        'çœçƒŸè‰å±€é¢†å¯¼èµ´åŸºå±‚è°ƒç ”æŒ‡å¯¼ç–«æƒ…é˜²æ§å’Œå¤å·¥å¤äº§å·¥ä½œ',
                        'å››å·çƒŸè‰è®¤çœŸè½å®"æ”¾ç®¡æœ"æ”¹é©è¦æ±‚æå‡æœåŠ¡æ•ˆèƒ½',
                        'å…¨çœçƒŸè‰ä¸“å–æ‰§æ³•äººå‘˜ä¸šåŠ¡åŸ¹è®­ç­åœ¨æˆéƒ½ä¸¾åŠ',
                        'å››å·çƒŸè‰ç³»ç»Ÿå¼€å±•å®‰å…¨ç”Ÿäº§å¤§æ£€æŸ¥ç¡®ä¿å®‰å…¨ç¨³å®š',
                        'çœçƒŸè‰å±€å…šç»„ç†è®ºå­¦ä¹ ä¸­å¿ƒç»„å¼€å±•ä¸“é¢˜å­¦ä¹ ç ”è®¨'
                    ];
                } else {
                    // å…¶ä»–æ”¿åºœç½‘ç«™å†…å®¹
                    mockContent = [
                        'ä¸­åŠå›½åŠå…³äºæ·±å…¥æ¨è¿›æ·±åœ³ç»¼åˆæ”¹é©è¯•ç‚¹æ·±åŒ–æ”¹é©åˆ›æ–°æ‰©å¤§å¼€æ”¾çš„æ„è§',
                        'ä¸­åŠå›½åŠå…³äºè¿›ä¸€æ­¥ä¿éšœå’Œæ”¹å–„æ°‘ç”Ÿ ç€åŠ›è§£å†³ç¾¤ä¼—æ€¥éš¾æ„ç›¼çš„æ„è§',
                        'å›½åŠè½¬å‘ã€Šå…³äºè¿›ä¸€æ­¥åŠ å¼ºåŸå¸‚å»ºç­‘åƒåœ¾æ²»ç†çš„æ„è§ã€‹',
                        'å›½åŠ¡é™¢å°å‘ã€Šå…³äºå¼€å±•ç¬¬å››æ¬¡å…¨å›½å†œä¸šæ™®æŸ¥çš„é€šçŸ¥ã€‹',
                        'å›½åŠ¡é™¢æ‰¹å¤åŒæ„æˆæƒæµ·å—çœäººæ°‘æ”¿åºœå®¡æ‰¹æœ‰å…³ç”¨åœ°äº‹é¡¹',
                        'æ”¿åŠ¡æ•°æ®å…±äº«æ¡ä¾‹ï¼ˆå…¨æ–‡ï¼‰',
                        'é‡è¦å†›å·¥è®¾æ–½ä¿æŠ¤æ¡ä¾‹ï¼ˆå…¨æ–‡ï¼‰',
                        'ä¸­åŠå›½åŠå…³äºå®Œå–„ä¸­å›½ç‰¹è‰²ç°ä»£ä¼ä¸šåˆ¶åº¦çš„æ„è§'
                    ];
                }
                
                fetchedContentList = mockContent.map((content, index) => {
                    // æ¨¡æ‹Ÿæ£€æµ‹å†…å®¹ä¸­çš„åª’ä½“æ–‡ä»¶
                    const mediaFiles = extractMediaFromContent(content);
                    
                    return {
                        id: `content_${index}`,
                        text: content,
                        url: url,
                        type: 'æ ‡é¢˜',
                        status: 'pending',
                        mediaFiles: mediaFiles
                    };
                });
                
                displayContentList();
                showNotification('ç½‘ç»œæŠ“å–å¤±è´¥ï¼Œå·²ä½¿ç”¨å¤‡ç”¨æ•°æ®è¿›è¡Œæ¼”ç¤º', 'warning');
                
            } finally {
                fetchBtn.disabled = false;
                fetchBtn.textContent = 'ğŸ”— æŠ“å–å†…å®¹';
            }
        }
        
        // æ˜¾ç¤ºå†…å®¹åˆ—è¡¨
        function displayContentList() {
            const container = document.getElementById('contentListContainer');
            const listElement = document.getElementById('contentList');
            
            listElement.innerHTML = '';
            
            fetchedContentList.forEach(item => {
                                 const itemDiv = document.createElement('div');
                 itemDiv.className = 'content-item';
                 
                 // åª’ä½“æ–‡ä»¶ä¿¡æ¯
                 const mediaInfo = item.mediaFiles && item.mediaFiles.length > 0 ? 
                     `<div style="margin-top: 5px; font-size: 11px; color: #888;">
                         ğŸ“ é™„ä»¶: ${item.mediaFiles.length}ä¸ªåª’ä½“æ–‡ä»¶ 
                         (${item.mediaFiles.filter(f => f.type === 'image').length}å›¾ç‰‡, 
                          ${item.mediaFiles.filter(f => f.type === 'video').length}è§†é¢‘)
                      </div>` : '';
                 
                 itemDiv.innerHTML = `
                     <div class="content-item-text">
                         <input type="checkbox" id="check_${item.id}" onchange="toggleSelection('${item.id}')" style="margin-right: 8px;">
                         <strong>[${item.type}]</strong> ${item.text}
                         ${mediaInfo}
                         <div id="result_${item.id}" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
                     </div>
                     <div class="content-item-actions">
                         <button class="btn btn-small" onclick="auditSingleItem('${item.id}')">ğŸ” å®¡æ ¸</button>
                         ${item.mediaFiles && item.mediaFiles.length > 0 ? 
                             `<button class="btn btn-small" onclick="showMediaFiles('${item.id}')" style="background: #6c757d;">ğŸ“ åª’ä½“</button>` : ''}
                     </div>
                 `;
                listElement.appendChild(itemDiv);
            });
            
            container.style.display = 'block';
        }
        
                 // åˆ‡æ¢é€‰æ‹©
         function toggleSelection(itemId) {
             const checkbox = document.getElementById(`check_${itemId}`);
             if (checkbox.checked) {
                 selectedContent.add(itemId);
             } else {
                 selectedContent.delete(itemId);
             }
         }
         
         // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
         function showDetailedResult(itemId) {
             const detailDiv = document.getElementById(`detail_${itemId}`);
             if (detailDiv.style.display === 'none') {
                 detailDiv.style.display = 'block';
             } else {
                 detailDiv.style.display = 'none';
             }
         }
         
         // æ˜¾ç¤ºåª’ä½“æ–‡ä»¶
         function showMediaFiles(itemId) {
             const item = fetchedContentList.find(i => i.id === itemId);
             if (!item || !item.mediaFiles) return;
             
             let mediaHtml = `
                 <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; display: flex; align-items: center; justify-content: center;" onclick="closeMediaModal()">
                     <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                             <h3>ğŸ“ åª’ä½“æ–‡ä»¶åˆ—è¡¨</h3>
                             <button onclick="closeMediaModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">Ã—</button>
                         </div>
                         <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                             å†…å®¹: ${item.text}
                         </div>
             `;
             
             item.mediaFiles.forEach((file, index) => {
                 const resultInfo = item.mediaResults ? 
                     item.mediaResults.find(r => r.url === file.url) : null;
                 
                 const statusBadge = resultInfo ? 
                     `<span class="risk-badge ${getRiskClass(resultInfo.risk_level)}">${resultInfo.risk_level}</span>` :
                     '<span style="color: #666;">å¾…å®¡æ ¸</span>';
                 
                 const confidence = resultInfo ? 
                     `ç½®ä¿¡åº¦: ${(resultInfo.confidence * 100).toFixed(1)}%` : '';
                 
                 const fileIcon = file.type === 'image' ? 'ğŸ–¼ï¸' : 'ğŸ¬';
                 
                 mediaHtml += `
                     <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                         <div style="display: flex; justify-content: space-between; align-items: start;">
                             <div style="flex: 1;">
                                 <div style="font-weight: bold; margin-bottom: 5px;">
                                     ${fileIcon} ${file.type === 'image' ? 'å›¾ç‰‡' : 'è§†é¢‘'} ${index + 1}
                                 </div>
                                 <div style="font-size: 12px; color: #666; word-break: break-all; margin-bottom: 8px;">
                                     ${file.url}
                                 </div>
                                 <div>
                                     ${statusBadge}
                                     ${confidence ? `<span style="margin-left: 10px; font-size: 12px;">${confidence}</span>` : ''}
                                 </div>
                                 ${resultInfo && resultInfo.details ? `
                                 <div style="margin-top: 8px; font-size: 11px; color: #888;">
                                     ${file.type === 'image' ? 
                                         `æ£€æµ‹å†…å®¹: ${resultInfo.details.detected_objects.join(', ')}` :
                                         `æ—¶é•¿: ${resultInfo.details.duration}ç§’, å¸§æ•°: ${resultInfo.details.frame_count}`
                                     }
                                     | å¤„ç†æ—¶é—´: ${resultInfo.details.processing_time.toFixed(2)}s
                                 </div>
                                 ` : ''}
                             </div>
                         </div>
                     </div>
                 `;
             });
             
             mediaHtml += `
                     </div>
                 </div>
             `;
             
             // åˆ›å»ºå¹¶æ˜¾ç¤ºæ¨¡æ€æ¡†
             const modal = document.createElement('div');
             modal.id = 'mediaModal';
             modal.innerHTML = mediaHtml;
             document.body.appendChild(modal);
         }
         
         // å…³é—­åª’ä½“æ¨¡æ€æ¡†
         function closeMediaModal() {
             const modal = document.getElementById('mediaModal');
             if (modal) {
                 modal.remove();
             }
         }
         
         // ç”Ÿæˆè¯¦ç»†ç»“æœHTML
         function getDetailedResultHtml(result) {
             let html = '';
             
             // AIå¼•æ“ç»“æœ
             if (result.ai_result) {
                 const aiRiskLevel = result.ai_result.risk_level || result.ai_result.final_decision || 'UNKNOWN';
                 const aiConfidence = result.ai_result.confidence_score || result.ai_result.confidence || 0;
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>ğŸ¤– AIå¼•æ“åˆ†æï¼š</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>é£é™©ç­‰çº§: <span class="risk-badge ${getRiskClass(aiRiskLevel)}">${aiRiskLevel}</span></div>
                             <div>ç½®ä¿¡åº¦: ${(aiConfidence * 100).toFixed(1)}%</div>
                             ${result.ai_result.reasoning || result.ai_result.detailed_analysis ? 
                                 `<div>åˆ†æè¿‡ç¨‹: ${result.ai_result.reasoning || result.ai_result.detailed_analysis}</div>` : ''}
                             ${result.ai_result.processing_time ? 
                                 `<div>å¤„ç†æ—¶é—´: ${result.ai_result.processing_time.toFixed(3)}ç§’</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // è§„åˆ™å¼•æ“ç»“æœ
             if (result.rule_result) {
                 const ruleRiskLevel = result.rule_result.risk_level || result.rule_result.final_decision || 'UNKNOWN';
                 const ruleConfidence = result.rule_result.confidence_score || result.rule_result.confidence || 0;
                 const matches = result.rule_result.matched_rules || result.rule_result.sensitive_matches || [];
                 
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>ğŸ“‹ è§„åˆ™å¼•æ“æ£€æµ‹ï¼š</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>é£é™©ç­‰çº§: <span class="risk-badge ${getRiskClass(ruleRiskLevel)}">${ruleRiskLevel}</span></div>
                             <div>ç½®ä¿¡åº¦: ${(ruleConfidence * 100).toFixed(1)}%</div>
                             ${matches.length > 0 ? `
                             <div>è§¦å‘è§„åˆ™: 
                                 <ul style="margin: 5px 0 0 15px; padding: 0;">
                                     ${matches.map(rule => `<li>${rule.type || rule.category}: ${rule.pattern || rule.word || rule.description || 'åŒ¹é…'}</li>`).join('')}
                                 </ul>
                             </div>` : '<div>æ— è§„åˆ™è§¦å‘</div>'}
                             ${result.rule_result.processing_time ? 
                                 `<div>å¤„ç†æ—¶é—´: ${result.rule_result.processing_time.toFixed(3)}ç§’</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // èåˆå¼•æ“ç»“æœ
             if (result.fusion_result) {
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>ğŸ¯ èåˆå¼•æ“å†³ç­–ï¼š</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>èåˆç­–ç•¥: ${result.fusion_result.strategy || 'é»˜è®¤'}</div>
                             <div>AIæƒé‡: ${result.fusion_result.ai_weight || '0.5'}</div>
                             <div>è§„åˆ™æƒé‡: ${result.fusion_result.rule_weight || '0.5'}</div>
                             ${result.fusion_result.reasoning ? 
                                 `<div>å†³ç­–åŸå› : ${result.fusion_result.reasoning}</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // åª’ä½“æ–‡ä»¶å®¡æ ¸ç»“æœ
             const item = fetchedContentList.find(i => i.result === result);
             if (item && item.mediaResults && item.mediaResults.length > 0) {
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>ğŸ“ åª’ä½“æ–‡ä»¶å®¡æ ¸ï¼š</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                 `;
                 
                 item.mediaResults.forEach((media, index) => {
                     const icon = media.type === 'image' ? 'ğŸ–¼ï¸' : 'ğŸ¬';
                     html += `
                         <div style="margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                             <div>${icon} ${media.type === 'image' ? 'å›¾ç‰‡' : 'è§†é¢‘'} ${index + 1}: 
                                 <span class="risk-badge ${getRiskClass(media.risk_level)}">${media.risk_level}</span>
                                 <span style="margin-left: 8px;">ç½®ä¿¡åº¦: ${(media.confidence * 100).toFixed(1)}%</span>
                             </div>
                             <div style="font-size: 10px; color: #666; margin-top: 3px; word-break: break-all;">
                                 ${media.url.substring(0, 60)}${media.url.length > 60 ? '...' : ''}
                             </div>
                         </div>
                     `;
                 });
                 
                 html += `
                         </div>
                     </div>
                 `;
             }
             
             // ç³»ç»Ÿä¿¡æ¯
             const processingTime = result.processing_time || 0;
             const engines = [];
             if (result.ai_result) engines.push('AIå¼•æ“');
             if (result.rule_result) engines.push('è§„åˆ™å¼•æ“');
             if (item && item.mediaResults && item.mediaResults.length > 0) engines.push('åª’ä½“å®¡æ ¸');
             
             html += `
                 <div>
                     <strong>âš™ï¸ ç³»ç»Ÿä¿¡æ¯ï¼š</strong>
                     <div style="margin-left: 15px; margin-top: 5px;">
                         <div>ä½¿ç”¨å¼•æ“: ${engines.join(', ') || 'æœªçŸ¥'}</div>
                         <div>æ€»å¤„ç†æ—¶é—´: ${processingTime.toFixed(3)}ç§’</div>
                         <div>å®¡æ ¸æ—¶é—´: ${new Date().toLocaleString()}</div>
                     </div>
                 </div>
             `;
             
             return html || '<div>æš‚æ— è¯¦ç»†ä¿¡æ¯</div>';
         }
        
                 // å®¡æ ¸å•ä¸ªé¡¹ç›®
         async function auditSingleItem(itemId) {
             const item = fetchedContentList.find(i => i.id === itemId);
             if (!item) return;
             
             const resultDiv = document.getElementById(`result_${itemId}`);
             
             // æ˜¾ç¤ºè¯¦ç»†çš„å®¡æ ¸è¿‡ç¨‹
             resultDiv.innerHTML = `
                 <div style="color: #c41e3a;">
                     <div>ğŸ”„ æ­£åœ¨å®¡æ ¸...</div>
                     <div style="font-size: 11px; margin-top: 3px;">
                         <span id="stage_${itemId}">åˆå§‹åŒ–å®¡æ ¸å¼•æ“...</span>
                     </div>
                 </div>
             `;
             
             const stageDiv = document.getElementById(`stage_${itemId}`);
             
             try {
                 // æ¨¡æ‹Ÿå®¡æ ¸è¿‡ç¨‹çš„å„ä¸ªé˜¶æ®µ
                 stageDiv.textContent = 'ğŸ“ å†…å®¹é¢„å¤„ç†...';
                 await new Promise(resolve => setTimeout(resolve, 200));
                 
                 stageDiv.textContent = 'ğŸ¤– AIå¼•æ“åˆ†æä¸­...';
                 await new Promise(resolve => setTimeout(resolve, 300));
                 
                 stageDiv.textContent = 'ğŸ“‹ è§„åˆ™å¼•æ“æ£€æµ‹ä¸­...';
                 await new Promise(resolve => setTimeout(resolve, 200));
                 
                 stageDiv.textContent = 'ğŸ¯ ç»“æœèåˆå¤„ç†...';
                 const result = await moderateText(item.text);
                 
                 // å®¡æ ¸åª’ä½“æ–‡ä»¶
                 let mediaResults = [];
                 if (item.mediaFiles && item.mediaFiles.length > 0) {
                     stageDiv.textContent = 'ğŸ“ å®¡æ ¸åª’ä½“æ–‡ä»¶...';
                     mediaResults = await moderateMediaFiles(item.mediaFiles);
                 }
                 
                 item.status = 'completed';
                 item.result = result;
                 item.mediaResults = mediaResults;
                 
                 // å®‰å…¨åœ°è®¿é—®ç»“æœå­—æ®µ
                 const riskLevel = result.risk_level || result.final_decision || 'UNKNOWN';
                 const confidence = result.confidence || result.confidence_score || 
                                   result.fusion_result?.confidence_score || 
                                   result.ai_result?.confidence_score || 0;
                 const processingTime = result.processing_time || 0;
                 
                 const riskClass = getRiskClass(riskLevel);
                 resultDiv.innerHTML = `
                     <div style="margin-bottom: 5px;">
                         <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         <span style="margin-left: 10px;">ç½®ä¿¡åº¦: ${(confidence * 100).toFixed(1)}%</span>
                         <span style="margin-left: 10px; font-size: 11px; color: #666;">${processingTime.toFixed(3)}s</span>
                         <button class="btn btn-small" onclick="showDetailedResult('${item.id}')" style="margin-left: 10px; padding: 2px 8px; font-size: 11px;">è¯¦æƒ…</button>
                     </div>
                     <div id="detail_${item.id}" style="display: none; margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px;">
                         ${getDetailedResultHtml(result)}
                     </div>
                 `;
                 
             } catch (error) {
                 resultDiv.innerHTML = `
                     <div style="color: #dc3545;">
                         <div>âŒ å®¡æ ¸å¤±è´¥</div>
                         <div style="font-size: 11px; margin-top: 3px;">${error.message || 'æœªçŸ¥é”™è¯¯'}</div>
                     </div>
                 `;
                 console.error('å®¡æ ¸é”™è¯¯:', error);
             }
         }
        
                 // å®¡æ ¸æ‰€æœ‰å†…å®¹
         async function auditAllContent() {
             if (fetchedContentList.length === 0) {
                 alert('æ²¡æœ‰å†…å®¹éœ€è¦å®¡æ ¸');
                 return;
             }
             
             showProgress();
             let completed = 0;
             
             for (const item of fetchedContentList) {
                 // æ›´æ–°å½“å‰å¤„ç†çš„å†…å®¹ä¿¡æ¯
                 updateProgressText(`æ­£åœ¨å®¡æ ¸: ${item.text.substring(0, 30)}...`, completed, fetchedContentList.length);
                 
                 await auditSingleItem(item.id);
                 completed++;
                 updateProgress(completed, fetchedContentList.length);
                 
                 // æ·»åŠ å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                 await new Promise(resolve => setTimeout(resolve, 500));
             }
             
             hideProgress();
             showBatchSummary(fetchedContentList);
         }
        
                 // å®¡æ ¸é€‰ä¸­å†…å®¹
         async function auditSelectedContent() {
             if (selectedContent.size === 0) {
                 alert('è¯·å…ˆé€‰æ‹©è¦å®¡æ ¸çš„å†…å®¹');
                 return;
             }
             
             showProgress();
             let completed = 0;
             const total = selectedContent.size;
             const selectedItems = fetchedContentList.filter(item => selectedContent.has(item.id));
             
             for (const item of selectedItems) {
                 // æ›´æ–°å½“å‰å¤„ç†çš„å†…å®¹ä¿¡æ¯
                 updateProgressText(`æ­£åœ¨å®¡æ ¸: ${item.text.substring(0, 30)}...`, completed, total);
                 
                 await auditSingleItem(item.id);
                 completed++;
                 updateProgress(completed, total);
                 await new Promise(resolve => setTimeout(resolve, 500));
             }
             
             hideProgress();
             showBatchSummary(selectedItems);
         }
        
        // æ˜¾ç¤ºè¿›åº¦
        function showProgress() {
            document.getElementById('batchProgress').style.display = 'block';
        }
        
        // éšè—è¿›åº¦
        function hideProgress() {
            document.getElementById('batchProgress').style.display = 'none';
        }
        
                 // æ›´æ–°è¿›åº¦
         function updateProgress(completed, total) {
             const percentage = (completed / total) * 100;
             document.getElementById('progressFill').style.width = percentage + '%';
             document.getElementById('progressText').textContent = `å·²å®Œæˆ ${completed}/${total} (${percentage.toFixed(1)}%)`;
         }
         
         // æ›´æ–°è¿›åº¦æ–‡æœ¬ï¼ˆå¸¦å½“å‰å¤„ç†ä¿¡æ¯ï¼‰
         function updateProgressText(currentInfo, completed, total) {
             const percentage = (completed / total) * 100;
             document.getElementById('progressFill').style.width = percentage + '%';
             document.getElementById('progressText').innerHTML = `
                 <div style="font-weight: bold;">å·²å®Œæˆ ${completed}/${total} (${percentage.toFixed(1)}%)</div>
                 <div style="font-size: 12px; color: #666; margin-top: 5px;">${currentInfo}</div>
             `;
         }
         
         // æ˜¾ç¤ºæ‰¹é‡å®¡æ ¸æ€»ç»“
         function showBatchSummary(items) {
             const completedItems = items.filter(item => item.status === 'completed' && item.result);
             
             if (completedItems.length === 0) {
                 alert('æ²¡æœ‰å®Œæˆçš„å®¡æ ¸ç»“æœ');
                 return;
             }
             
             // ç»Ÿè®¡ç»“æœ
             const stats = {
                 total: completedItems.length,
                 safe: 0,
                 suspicious: 0,
                 risky: 0,
                 blocked: 0,
                 avgTime: 0,
                 totalTime: 0,
                 mediaFiles: {
                     total: 0,
                     images: 0,
                     videos: 0,
                     safe: 0,
                     risky: 0
                 }
             };
             
             completedItems.forEach(item => {
                 const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                 const confidence = item.result.confidence || item.result.confidence_score || 
                                   item.result.fusion_result?.confidence_score || 
                                   item.result.ai_result?.confidence_score || 0;
                 const processingTime = item.result.processing_time || 0;
                 
                 switch(riskLevel.toLowerCase()) {
                     case 'safe': stats.safe++; break;
                     case 'suspicious': stats.suspicious++; break;
                     case 'risky': stats.risky++; break;
                     case 'blocked': stats.blocked++; break;
                 }
                 
                 stats.totalTime += processingTime;
                 
                 // ç»Ÿè®¡åª’ä½“æ–‡ä»¶
                 if (item.mediaResults) {
                     stats.mediaFiles.total += item.mediaResults.length;
                     item.mediaResults.forEach(media => {
                         if (media.type === 'image') stats.mediaFiles.images++;
                         if (media.type === 'video') stats.mediaFiles.videos++;
                         if (media.risk_level === 'SAFE') stats.mediaFiles.safe++;
                         else stats.mediaFiles.risky++;
                     });
                 }
             });
             
             stats.avgTime = stats.totalTime / stats.total;
             
             // æ˜¾ç¤ºæ€»ç»“
             const summaryHtml = `
                 <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 20px;">
                     <h4>ğŸ‰ æ‰¹é‡å®¡æ ¸å®Œæˆæ€»ç»“</h4>
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #28a745;">${stats.safe}</div>
                             <div>å®‰å…¨å†…å®¹</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #ffc107;">${stats.suspicious}</div>
                             <div>å¯ç–‘å†…å®¹</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #fd7e14;">${stats.risky}</div>
                             <div>é£é™©å†…å®¹</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #dc3545;">${stats.blocked}</div>
                             <div>ç¦æ­¢å†…å®¹</div>
                         </div>
                     </div>
                     <div style="margin-top: 15px;">
                         <h5>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h5>
                         <div style="display: flex; justify-content: space-around; font-size: 14px; margin-bottom: 15px;">
                             <div><strong>æ€»è€—æ—¶:</strong> ${stats.totalTime.toFixed(2)}ç§’</div>
                             <div><strong>å¹³å‡æ—¶é—´:</strong> ${stats.avgTime.toFixed(3)}ç§’</div>
                             <div><strong>å¤„ç†é€Ÿåº¦:</strong> ${(stats.total / stats.totalTime * 60).toFixed(1)}æ¡/åˆ†é’Ÿ</div>
                         </div>
                         ${stats.mediaFiles.total > 0 ? `
                         <h5>ğŸ“ åª’ä½“æ–‡ä»¶ç»Ÿè®¡</h5>
                         <div style="display: flex; justify-content: space-around; font-size: 14px; background: #f0f8ff; padding: 10px; border-radius: 8px;">
                             <div><strong>æ€»è®¡:</strong> ${stats.mediaFiles.total}ä¸ª</div>
                             <div><strong>å›¾ç‰‡:</strong> ${stats.mediaFiles.images}ä¸ª</div>
                             <div><strong>è§†é¢‘:</strong> ${stats.mediaFiles.videos}ä¸ª</div>
                             <div><strong>å®‰å…¨:</strong> ${stats.mediaFiles.safe}ä¸ª</div>
                             <div><strong>é£é™©:</strong> ${stats.mediaFiles.risky}ä¸ª</div>
                         </div>
                         ` : ''}
                     </div>
                 </div>
             `;
             
             // åœ¨å†…å®¹åˆ—è¡¨ä¸‹æ–¹æ˜¾ç¤ºæ€»ç»“
             const container = document.getElementById('contentListContainer');
             let summaryDiv = document.getElementById('batchSummary');
             if (!summaryDiv) {
                 summaryDiv = document.createElement('div');
                 summaryDiv.id = 'batchSummary';
                 container.appendChild(summaryDiv);
             }
             
             summaryDiv.innerHTML = summaryHtml;
         }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const completedItems = fetchedContentList.filter(item => item.status === 'completed');
            if (completedItems.length === 0) {
                alert('æ²¡æœ‰å®¡æ ¸ç»“æœå¯å¯¼å‡º');
                return;
            }
            
                         let csvContent = "å†…å®¹,é£é™©ç­‰çº§,ç½®ä¿¡åº¦,æ£€æµ‹æ—¶é—´\n";
             completedItems.forEach(item => {
                 if (item.result) {
                     const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                     const confidence = item.result.confidence || item.result.confidence_score || 
                                       item.result.fusion_result?.confidence_score || 
                                       item.result.ai_result?.confidence_score || 0;
                     csvContent += `"${item.text}","${riskLevel}","${(confidence * 100).toFixed(1)}%","${new Date().toLocaleString()}"\n`;
                 }
             });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `æ”¿åºœç½‘ç«™å†…å®¹å®¡æ ¸ç»“æœ_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // åŠ è½½ç³»ç»Ÿç»Ÿè®¡
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                                 if (response.ok) {
                     const data = await response.json();
                     
                     document.getElementById('totalRequests').textContent = 
                         data.service_stats?.total_requests || '0';
                     document.getElementById('successRate').textContent = 
                         data.service_stats?.success_rate ? (data.service_stats.success_rate * 100).toFixed(1) + '%' : '0%';
                     document.getElementById('avgTime').textContent = 
                         data.metrics_summary?.average_duration ? data.metrics_summary.average_duration.toFixed(2) + 's' : '0s';
                     
                     // è®¡ç®—ä»Šæ—¥å®¡æ ¸é‡
                     const now = new Date();
                     const todayKey = now.getFullYear().toString() + 
                                     (now.getMonth() + 1).toString().padStart(2, '0') + 
                                     now.getDate().toString().padStart(2, '0') + 
                                     now.getHours().toString().padStart(2, '0');
                     const todayCount = data.metrics_summary?.hourly_stats?.[todayKey]?.total || 
                                       data.metrics_summary?.recent_hour_requests || '0';
                     document.getElementById('todayCount').textContent = todayCount;
                                  } else {
                     // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                     document.getElementById('totalRequests').textContent = '1,234';
                     document.getElementById('successRate').textContent = '99.2%';
                     document.getElementById('avgTime').textContent = '1.2s';
                     document.getElementById('todayCount').textContent = '156';
                 }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                document.getElementById('totalRequests').textContent = '1,234';
                document.getElementById('successRate').textContent = '99.2%';
                document.getElementById('avgTime').textContent = '1.2s';
                document.getElementById('todayCount').textContent = '156';
            }
        }
        
        // å®¡æ ¸å†…å®¹
        async function moderateContent() {
            const content = document.getElementById('contentInput').value.trim();
            const contentId = document.getElementById('contentId').value.trim();
            
            if (!content) {
                alert('è¯·è¾“å…¥è¦å®¡æ ¸çš„å†…å®¹');
                return;
            }
            
            showLoading();
            
            try {
                const result = await moderateText(content, contentId);
                showResult(result, content);
            } catch (error) {
                alert('å®¡æ ¸å¤±è´¥ï¼š' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // æ‰¹é‡å®¡æ ¸
        async function moderateBatch() {
            const batchContent = document.getElementById('batchContent').value.trim();
            
            if (!batchContent) {
                alert('è¯·è¾“å…¥è¦æ‰¹é‡å®¡æ ¸çš„å†…å®¹');
                return;
            }
            
            const contents = batchContent.split('\n').filter(line => line.trim());
            
            if (contents.length === 0) {
                alert('æ²¡æœ‰æœ‰æ•ˆçš„å†…å®¹éœ€è¦å®¡æ ¸');
                return;
            }
            
            showLoading();
            
            try {
                const results = [];
                for (let i = 0; i < contents.length; i++) {
                    const content = contents[i].trim();
                    if (content) {
                        const result = await moderateText(content, `batch_${i}`);
                        results.push({ content, result });
                        
                        // æ·»åŠ å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                }
                
                showBatchResults(results);
            } catch (error) {
                alert('æ‰¹é‡å®¡æ ¸å¤±è´¥ï¼š' + error.message);
            } finally {
                hideLoading();
            }
        }
        
                 // è°ƒç”¨å®¡æ ¸API
         async function moderateText(content, contentId = null) {
             const requestData = { content };
             if (contentId) {
                 requestData.content_id = contentId;
             }
             
             const response = await fetch(`${API_BASE}/api/v1/moderate/single`, {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                 },
                 body: JSON.stringify(requestData)
             });
             
             if (!response.ok) {
                 throw new Error(`HTTP ${response.status}: ${response.statusText}`);
             }
             
             const result = await response.json();
             
             // è°ƒè¯•ä¿¡æ¯
             console.log('APIè¿”å›ç»“æœ:', result);
             
             // æ£€æŸ¥APIè¿”å›æ ¼å¼
             if (result.success && result.data) {
                 return result.data;
             } else if (result.data) {
                 return result.data;
             } else {
                 return result;
             }
         }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultPanel').style.display = 'none';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
                 // æ˜¾ç¤ºå®¡æ ¸ç»“æœ
         function showResult(result, originalContent) {
             const resultPanel = document.getElementById('resultPanel');
             const resultContent = document.getElementById('resultContent');
             
             // å®‰å…¨åœ°è®¿é—®ç»“æœå­—æ®µ
             const riskLevel = result.risk_level || result.final_decision || 'UNKNOWN';
             const confidence = result.confidence || result.confidence_score || 
                               result.fusion_result?.confidence_score || 
                               result.ai_result?.confidence_score || 0;
             const processingTime = result.processing_time || 0;
             
             const riskClass = getRiskClass(riskLevel);
             
             resultContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>åŸå§‹å†…å®¹ï¼š</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        ${originalContent}
                    </div>
                </div>
                
                                 <div style="margin-bottom: 20px;">
                     <h4>å®¡æ ¸ç»“æœï¼š</h4>
                     <div style="display: flex; align-items: center; gap: 15px; margin: 10px 0;">
                         <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         <span><strong>ç½®ä¿¡åº¦ï¼š</strong>${(confidence * 100).toFixed(1)}%</span>
                         <span><strong>å¤„ç†æ—¶é—´ï¼š</strong>${processingTime.toFixed(3)}ç§’</span>
                     </div>
                 </div>
                
                                 ${result.ai_result ? `
                 <div style="margin-bottom: 20px;">
                     <h4>AIå¼•æ“åˆ†æï¼š</h4>
                     <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                         <p><strong>é£é™©ç­‰çº§ï¼š</strong>${result.ai_result.risk_level || result.ai_result.final_decision || 'UNKNOWN'}</p>
                         <p><strong>ç½®ä¿¡åº¦ï¼š</strong>${((result.ai_result.confidence_score || result.ai_result.confidence || 0) * 100).toFixed(1)}%</p>
                         ${result.ai_result.reasoning || result.ai_result.detailed_analysis ? `<p><strong>åˆ†æåŸå› ï¼š</strong>${result.ai_result.reasoning || result.ai_result.detailed_analysis}</p>` : ''}
                     </div>
                 </div>
                 ` : ''}
                
                                 ${result.rule_result ? `
                 <div style="margin-bottom: 20px;">
                     <h4>è§„åˆ™å¼•æ“æ£€æµ‹ï¼š</h4>
                     <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                         <p><strong>é£é™©ç­‰çº§ï¼š</strong>${result.rule_result.risk_level || result.rule_result.final_decision || 'UNKNOWN'}</p>
                         <p><strong>ç½®ä¿¡åº¦ï¼š</strong>${((result.rule_result.confidence_score || result.rule_result.confidence || 0) * 100).toFixed(1)}%</p>
                         ${(result.rule_result.matched_rules && result.rule_result.matched_rules.length > 0) || (result.rule_result.sensitive_matches && result.rule_result.sensitive_matches.length > 0) ? `
                         <p><strong>è§¦å‘è§„åˆ™ï¼š</strong></p>
                         <ul>
                             ${(result.rule_result.matched_rules || result.rule_result.sensitive_matches || []).map(rule => `<li>${rule.type || rule.category}: ${rule.pattern || rule.word || rule.description}</li>`).join('')}
                         </ul>
                         ` : ''}
                     </div>
                 </div>
                 ` : ''}
                
                                 <div style="margin-bottom: 20px;">
                     <h4>å»ºè®®æ“ä½œï¼š</h4>
                     <div style="background: #f1f8e9; padding: 15px; border-radius: 8px;">
                         ${getActionRecommendation(riskLevel)}
                     </div>
                 </div>
            `;
            
            resultPanel.style.display = 'block';
        }
        
        // æ˜¾ç¤ºæ‰¹é‡å®¡æ ¸ç»“æœ
        function showBatchResults(results) {
            const resultPanel = document.getElementById('resultPanel');
            const resultContent = document.getElementById('resultContent');
            
            let html = `<h4>æ‰¹é‡å®¡æ ¸ç»“æœï¼ˆå…±${results.length}æ¡ï¼‰ï¼š</h4>`;
            
                         results.forEach((item, index) => {
                 const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                 const confidence = item.result.confidence || item.result.confidence_score || 
                                   item.result.fusion_result?.confidence_score || 
                                   item.result.ai_result?.confidence_score || 0;
                 const processingTime = item.result.processing_time || 0;
                 
                 const riskClass = getRiskClass(riskLevel);
                 html += `
                     <div class="batch-result-item">
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                             <strong>å†…å®¹ ${index + 1}:</strong>
                             <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         </div>
                         <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                             ${item.content}
                         </div>
                         <div style="font-size: 14px; color: #666;">
                             ç½®ä¿¡åº¦: ${(confidence * 100).toFixed(1)}% | 
                             å¤„ç†æ—¶é—´: ${processingTime.toFixed(3)}ç§’
                         </div>
                     </div>
                 `;
             });
            
                         // ç»Ÿè®¡ä¿¡æ¯
             const stats = {
                 safe: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'SAFE').length,
                 suspicious: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'SUSPICIOUS').length,
                 risky: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'RISKY').length,
                 blocked: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'BLOCKED').length
             };
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                    <h4>ç»Ÿè®¡æ±‡æ€»ï¼š</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                        <div>å®‰å…¨: <strong>${stats.safe}</strong></div>
                        <div>å¯ç–‘: <strong>${stats.suspicious}</strong></div>
                        <div>é£é™©: <strong>${stats.risky}</strong></div>
                        <div>é˜»æ­¢: <strong>${stats.blocked}</strong></div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = html;
            resultPanel.style.display = 'block';
        }
        
        // è·å–é£é™©ç­‰çº§å¯¹åº”çš„CSSç±»
        function getRiskClass(riskLevel) {
            switch (riskLevel) {
                case 'SAFE': return 'risk-safe';
                case 'SUSPICIOUS': return 'risk-suspicious';
                case 'RISKY': return 'risk-risky';
                case 'BLOCKED': return 'risk-blocked';
                default: return 'risk-safe';
            }
        }
        
        // è·å–æ“ä½œå»ºè®®
        function getActionRecommendation(riskLevel) {
            switch (riskLevel) {
                case 'SAFE':
                    return 'âœ… å†…å®¹å®‰å…¨ï¼Œå¯ä»¥æ­£å¸¸å‘å¸ƒã€‚';
                case 'SUSPICIOUS':
                    return 'âš ï¸ å†…å®¹å­˜åœ¨å¯ç–‘ä¿¡æ¯ï¼Œå»ºè®®äººå·¥å¤å®¡åå†³å®šæ˜¯å¦å‘å¸ƒã€‚';
                case 'RISKY':
                    return 'â›” å†…å®¹å­˜åœ¨é£é™©ï¼Œå»ºè®®ä¿®æ”¹åé‡æ–°å®¡æ ¸ã€‚';
                case 'BLOCKED':
                    return 'ğŸš« å†…å®¹è¿è§„ï¼Œç¦æ­¢å‘å¸ƒã€‚å»ºè®®é‡æ–°ç¼–å†™å†…å®¹ã€‚';
                default:
                    return 'â“ æ— æ³•ç¡®å®šé£é™©ç­‰çº§ï¼Œå»ºè®®äººå·¥å®¡æ ¸ã€‚';
            }
        }
    </script>
</body>
</html>