<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπÂÆ°Ê†∏Á≥ªÁªü - ÊºîÁ§∫È°µÈù¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .demo-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            background: #fafafa;
        }
        
        .demo-section h2 {
            color: #c41e3a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #c41e3a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
            font-family: monospace;
        }
        
        .input-group textarea:focus {
            outline: none;
            border-color: #c41e3a;
        }
        
        .input-group input[type="text"], .input-group input[type="url"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input[type="text"]:focus, .input-group input[type="url"]:focus {
            outline: none;
            border-color: #c41e3a;
        }
        
        .btn {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(196, 30, 58, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.3);
        }
        
        .result-panel {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #c41e3a;
        }
        
        .result-panel h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .risk-safe {
            background: #d4edda;
            color: #155724;
        }
        
        .risk-suspicious {
            background: #fff3cd;
            color: #856404;
        }
        
        .risk-risky {
            background: #f8d7da;
            color: #721c24;
        }
        
        .risk-blocked {
            background: #f5c6cb;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #c41e3a;
            display: block;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #c41e3a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .gov-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .example-btn {
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 14px;
        }
        
        .example-btn:hover {
            background: #e9ecef;
            border-color: #c41e3a;
        }
        
        .example-btn.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            color: #c41e3a;
            border-bottom-color: #c41e3a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            align-items: end;
        }
        
        .url-input-group .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .content-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: white;
        }
        
        .content-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-item:last-child {
            border-bottom: none;
        }
        
        .content-item-text {
            flex: 1;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .content-item-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .batch-result {
            margin-top: 20px;
        }
        
        .batch-result-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #c41e3a;
            background: #f8f9fa;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #c41e3a 0%, #8b1538 100%);
            transition: width 0.3s;
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è ÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπÂÆ°Ê†∏Á≥ªÁªü</h1>
            <p>‰∏ì‰∏∫ÊîøÂ∫úÂÆòÁΩëÂÜÖÂÆπÁõëÁÆ°ËÆæËÆ°ÁöÑAIÊô∫ËÉΩÂÆ°Ê†∏Âπ≥Âè∞</p>
        </div>
        
        <div class="content">
            <!-- Á≥ªÁªüÁä∂ÊÄÅ -->
            <div class="demo-section">
                <h2>üìä Á≥ªÁªüËøêË°åÁä∂ÊÄÅ</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalRequests">-</span>
                        <div class="stat-label">ÊÄªÂÆ°Ê†∏ËØ∑Ê±Ç</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="successRate">-</span>
                        <div class="stat-label">ÂÆ°Ê†∏ÊàêÂäüÁéá</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="avgTime">-</span>
                        <div class="stat-label">Âπ≥ÂùáÂ§ÑÁêÜÊó∂Èó¥</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="todayCount">-</span>
                        <div class="stat-label">‰ªäÊó•ÂÆ°Ê†∏Èáè</div>
                    </div>
                </div>
            </div>
            
            <!-- ÂÜÖÂÆπÂÆ°Ê†∏ -->
            <div class="demo-section">
                <h2>üîç ÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπÂÆ°Ê†∏</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('url')">üìã ÁΩëÈ°µÂÜÖÂÆπÊäìÂèñ</div>
                    <div class="tab" onclick="switchTab('single')">üìù ÂçïÊù°ÂÜÖÂÆπÂÆ°Ê†∏</div>
                    <div class="tab" onclick="switchTab('batch')">üì¶ ÊâπÈáèÂÜÖÂÆπÂÆ°Ê†∏</div>
                </div>
                
                <!-- ÁΩëÈ°µÂÜÖÂÆπÊäìÂèñ -->
                <div id="urlTab" class="tab-content active">
                                         <div class="gov-examples">
                         <button class="example-btn" onclick="setExampleUrl('http://sc.tobacco.gov.cn/news/shizhengyaowen')">
                             üö¨ ÁÉüËçâÂ±ÄÊó∂ÊîøË¶ÅÈóª
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/pushinfo/v150203/index.htm')">
                             üèõÔ∏è ÂõΩÂä°Èô¢‰ø°ÊÅØÈ°µÈù¢
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/xinwen/index.htm')">
                             üì∞ ÊîøÂ∫úÊñ∞ÈóªÈ°µÈù¢
                         </button>
                         <button class="example-btn" onclick="setExampleUrl('https://www.gov.cn/zhengce/index.htm')">
                             üìú ÊîøÁ≠ñÊñá‰ª∂È°µÈù¢
                         </button>
<!--                         <button class="example-btn" onclick="testScrapingStrategies()">-->
<!--                             üß™ ÊµãËØïÊäìÂèñÁ≠ñÁï•-->
<!--                         </button>-->
                     </div>
                    
                    <div class="url-input-group">
                                                 <div class="input-group">
                             <label for="urlInput">ÁõÆÊ†áURLÂú∞ÂùÄÔºö</label>
                             <input type="url" id="urlInput" placeholder="ËØ∑ËæìÂÖ•ÊîøÂ∫úÁΩëÁ´ôURLÔºåÂ¶ÇÔºöhttp://sc.tobacco.gov.cn/news/shizhengyaowen" value="http://sc.tobacco.gov.cn/news/shizhengyaowen">
                         </div>
                        <button class="btn" onclick="fetchUrlContent()" id="fetchBtn">
                            üîó ÊäìÂèñÂÜÖÂÆπ
                        </button>
                    </div>
                    
                    <!-- ÊäìÂèñÁöÑÂÜÖÂÆπÂàóË°® -->
                    <div id="contentListContainer" style="display: none;">
                        <h4>üìã ÊäìÂèñÂà∞ÁöÑÂÜÖÂÆπÂàóË°®Ôºö</h4>
                        <div class="content-list" id="contentList">
                            <!-- Âä®ÊÄÅÁîüÊàêÁöÑÂÜÖÂÆπÂàóË°® -->
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="auditAllContent()">üîç ÂÖ®ÈÉ®ÂÆ°Ê†∏</button>
                            <button class="btn btn-secondary" onclick="auditSelectedContent()">üéØ ÂÆ°Ê†∏ÈÄâ‰∏≠È°π</button>
                            <button class="btn btn-secondary" onclick="exportResults()">üìä ÂØºÂá∫ÁªìÊûú</button>
                        </div>
                        
                        <!-- ÊâπÈáèÂÆ°Ê†∏ËøõÂ∫¶ -->
                        <div id="batchProgress" style="display: none;">
                            <h4>ÂÆ°Ê†∏ËøõÂ∫¶Ôºö</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <p id="progressText">ÂáÜÂ§áÂºÄÂßã...</p>
                        </div>
                    </div>
                </div>
                
                <!-- ÂçïÊù°ÂÆ°Ê†∏ -->
                <div id="singleTab" class="tab-content">
                                         <div class="gov-examples">
                         <button class="example-btn" onclick="setExample('ÂõõÂ∑ùÁúÅÁÉüËçâ‰∏ìÂçñÂ±ÄÔºàÂÖ¨Âè∏ÔºâÂè¨ÂºÄ2024Âπ¥Â∫¶Â∑•‰Ωú‰ºöËÆÆ')">
                             üö¨ ÁÉüËçâÂ±ÄÊñ∞Èóª
                         </button>
                         <button class="example-btn" onclick="setExample('Ê∑±ÂÖ•Â≠¶‰π†Ë¥ØÂΩªÂÖöÁöÑ‰∫åÂçÅÂ§ßÁ≤æÁ•û Êé®Âä®ÁÉüËçâË°å‰∏öÈ´òË¥®ÈáèÂèëÂ±ï')">
                             üìú ÊîøÁ≠ñÂ≠¶‰π†
                         </button>
                         <button class="example-btn" onclick="setExample('ÁúÅÁÉüËçâÂ±ÄÈ¢ÜÂØºË∞ÉÁ†îÂ∑•‰ΩúÔºåËÅîÁ≥ªÁîµËØùÔºö028-12345678ÔºåÈÇÆÁÆ±Ôºöadmin@tobacco.gov.cn')">
                             üìû ÂåÖÂê´ËÅîÁ≥ªÊñπÂºè
                         </button>
                         <button class="example-btn" onclick="setExample('Ëøô‰∏™ÁÉüËçâÊîøÁ≠ñÂÆåÂÖ®‰∏çÂêàÁêÜÔºåÁ∫ØÁ≤πÊòØÂà©ÁõäÈ©±Âä®ÔºÅ')">
                             üí¢ Ë¥üÈù¢ËØÑËÆ∫ÊµãËØï
                         </button>
                     </div>
                    
                    <div class="input-group">
                        <label for="contentInput">ÂæÖÂÆ°Ê†∏ÂÜÖÂÆπÔºö</label>
                        <textarea id="contentInput" placeholder="ËØ∑ËæìÂÖ•Ë¶ÅÂÆ°Ê†∏ÁöÑÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπ..."></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label for="contentId">ÂÜÖÂÆπIDÔºàÂèØÈÄâÔºâÔºö</label>
                        <input type="text" id="contentId" placeholder="‰æãÂ¶ÇÔºögov_content_001">
                    </div>
                    
                    <button class="btn" onclick="moderateContent()" id="moderateBtn">
                        üöÄ ÂºÄÂßãÂÆ°Ê†∏
                    </button>
                </div>
                
                <!-- ÊâπÈáèÂÆ°Ê†∏ -->
                <div id="batchTab" class="tab-content">
                    <div class="input-group">
                        <label for="batchContent">ÊâπÈáèÂÜÖÂÆπÔºàÊØèË°å‰∏ÄÊù°ÔºâÔºö</label>
                                                 <textarea id="batchContent" placeholder="ËØ∑ËæìÂÖ•Â§öÊù°ÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπÔºåÊØèË°å‰∏ÄÊù°...
Á§∫‰æãÔºö
ÂõõÂ∑ùÁúÅÁÉüËçâ‰∏ìÂçñÂ±ÄÔºàÂÖ¨Âè∏ÔºâÂè¨ÂºÄ2024Âπ¥Â∫¶Â∑•‰Ωú‰ºöËÆÆ
Ê∑±ÂÖ•Â≠¶‰π†Ë¥ØÂΩªÂÖöÁöÑ‰∫åÂçÅÂ§ßÁ≤æÁ•û Êé®Âä®ÁÉüËçâË°å‰∏öÈ´òË¥®ÈáèÂèëÂ±ï
ÂõõÂ∑ùÁÉüËçâÁ≥ªÁªüÁßØÊûÅÂºÄÂ±ïÂÖöÂè≤Â≠¶‰π†ÊïôËÇ≤ÂÆûË∑µÊ¥ªÂä®
ËÅîÁ≥ªÊàë‰ª¨Ôºö028-12345678
Ëøô‰∏™ÁÉüËçâÊîøÁ≠ñÊúâÈóÆÈ¢òÔºåÈúÄË¶ÅÈáçÊñ∞ËÄÉËôë"></textarea>
                    </div>
                    
                    <button class="btn" onclick="moderateBatch()" id="batchBtn">
                        üì¶ ÊâπÈáèÂÆ°Ê†∏
                    </button>
                </div>
                
                <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Ê≠£Âú®ÂÆ°Ê†∏‰∏≠ÔºåËØ∑Á®çÂÄô...</p>
                </div>
                
                <!-- ÁªìÊûúÊòæÁ§∫ -->
                <div class="result-panel" id="resultPanel" style="display: none;">
                    <h3>üìã ÂÆ°Ê†∏ÁªìÊûúÊä•Âëä</h3>
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // const API_BASE = 'http://localhost:8000';
        const API_BASE = `${window.location.protocol}//${window.location.host}`;
        let fetchedContentList = [];
        let selectedContent = new Set();
        
        // ÂàùÂßãÂåñÈ°µÈù¢
        window.onload = function() {
            loadStats();
            generateContentId();
        };
        
        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type = 'info') {
            // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;
            
            // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆÈ¢úËâ≤
            const colors = {
                'success': '#28a745',
                'warning': '#ffc107',
                'error': '#dc3545',
                'info': '#17a2b8'
            };
            notification.style.backgroundColor = colors[type] || colors.info;
            
            notification.textContent = message;
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(notification);
            
            // 3ÁßíÂêéËá™Âä®ÁßªÈô§
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ÂàáÊç¢Ê†áÁ≠æÈ°µ
        function switchTab(tabName) {
            // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Ê∑ªÂä†activeÁ±ª
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            // ÁâπÊÆäÂ§ÑÁêÜÊµãËØïÊäìÂèñÁ≠ñÁï•ÊåâÈíÆ
            const testStrategyButton = document.querySelector('button[onclick="testScrapingStrategies()"]');
            if (testStrategyButton && event.target !== testStrategyButton) {
                testStrategyButton.style.borderBottomColor = ''; // ÊÅ¢Â§çÈªòËÆ§ËæπÊ°ÜÈ¢úËâ≤
            }
        }

        // ÊµãËØïÊäìÂèñÁ≠ñÁï•
        async function testScrapingStrategies() {
            showNotification('Ê≠£Âú®ÊµãËØï‰∏çÂêåÁöÑÊäìÂèñÁ≠ñÁï•...', 'info');
            
            try {
                // ÊµãËØïÁÉüËçâÂ±ÄAPIËøûÊé•
                const testResponse = await fetch(`${API_BASE}/api/v1/test-tobacco`);
                const testResult = await testResponse.json();
                
                let strategyInfo = '';
                if (testResult.success) {
                    strategyInfo = '‚úÖ ÁúüÂÆûAPIÂèØÁî®\n';
                } else {
                    strategyInfo = '‚ùå ÁúüÂÆûAPI‰∏çÂèØÁî®\n';
                }
                
                // ÊµãËØïÊäìÂèñÂäüËÉΩ
                const scrapeResponse = await fetch(`${API_BASE}/api/v1/scrape`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: 'http://sc.tobacco.gov.cn/news/shizhengyaowen',
                        max_items: 3,
                        content_type: 'news'
                    })
                });
                
                const scrapeResult = await scrapeResponse.json();
                if (scrapeResult.success && scrapeResult.data.length > 0) {
                    const firstItem = scrapeResult.data[0];
                    if (firstItem.id.startsWith('enhanced_mock_')) {
                        strategyInfo += 'üéØ ÂΩìÂâç‰ΩøÁî®ÔºöÊô∫ËÉΩÊ®°ÊãüÊï∞ÊçÆ\n';
                        strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºöÈ´òÔºàÂü∫‰∫éÁúüÂÆûÊñ∞ÈóªÊ®°ÊùøÔºâ\n';
                        strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶ÔºöÂø´\n';
                        strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂä®ÊÄÅÁîüÊàê';
                    } else if (firstItem.id.startsWith('web_')) {
                        strategyInfo += 'üåê ÂΩìÂâç‰ΩøÁî®ÔºöÁΩëÈ°µÊäìÂèñ\n';
                        strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºö‰∏≠Ôºà‰æùËµñÁΩëÈ°µÁªìÊûÑÔºâ\n';
                        strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶Ôºö‰∏≠Á≠â\n';
                        strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂÆûÊó∂';
                    } else if (firstItem.id.startsWith('tobacco_')) {
                        strategyInfo += 'üéØ ÂΩìÂâç‰ΩøÁî®ÔºöÁúüÂÆûAPI\n';
                        strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºöÊúÄÈ´òÔºàÂÆòÊñπÊï∞ÊçÆÔºâ\n';
                        strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶ÔºöÂø´\n';
                        strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂÆûÊó∂';
                    }
                }
                
                // ÊòæÁ§∫Á≠ñÁï•‰ø°ÊÅØ
                alert(`ÊäìÂèñÁ≠ñÁï•ÊµãËØïÁªìÊûúÔºö\n\n${strategyInfo}`);
                
            } catch (error) {
                showNotification('Á≠ñÁï•ÊµãËØïÂ§±Ë¥•Ôºö' + error.message, 'error');
            }

            // ËÆæÁΩÆÊµãËØïÊäìÂèñÁ≠ñÁï•ÊåâÈíÆ‰∏∫ÈÄâ‰∏≠Áä∂ÊÄÅ
            const testStrategyButton = document.querySelector('button[onclick="testScrapingStrategies()"]');
            if (testStrategyButton) {
                testStrategyButton.style.borderBottomColor = '#c41e3a'; // ËÆæÁΩÆËìùËâ≤ËæπÊ°Ü
            }
        }
        
                 // ËÆæÁΩÆÁ§∫‰æãURL
         function setExampleUrl(url) {
             document.getElementById('urlInput').value = url;
             // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁ±ª
             document.querySelectorAll('.example-btn').forEach(btn => btn.classList.remove('active'));
             // ÁªôÂΩìÂâçÁÇπÂáªÁöÑÊåâÈíÆÊ∑ªÂä†activeÁ±ª
             event.target.classList.add('active');
         }
         
         // ÊµãËØïÊäìÂèñÁ≠ñÁï•
         async function testScrapingStrategies() {
             // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁ±ª
             document.querySelectorAll('.example-btn').forEach(btn => btn.classList.remove('active'));
             // ÁªôÂΩìÂâçÁÇπÂáªÁöÑÊåâÈíÆÊ∑ªÂä†activeÁ±ª
             event.target.classList.add('active');
             
             showNotification('Ê≠£Âú®ÊµãËØï‰∏çÂêåÁöÑÊäìÂèñÁ≠ñÁï•...', 'info');
             
             try {
                 // ÊµãËØïÁÉüËçâÂ±ÄAPIËøûÊé•
                 const testResponse = await fetch(`${API_BASE}/api/v1/test-tobacco`);
                 const testResult = await testResponse.json();
                 
                 let strategyInfo = '';
                 if (testResult.success) {
                     strategyInfo = '‚úÖ ÁúüÂÆûAPIÂèØÁî®\n';
                 } else {
                     strategyInfo = '‚ùå ÁúüÂÆûAPI‰∏çÂèØÁî®\n';
                 }
                 
                 // ÊµãËØïÊäìÂèñÂäüËÉΩ
                 const scrapeResponse = await fetch(`${API_BASE}/api/v1/scrape`, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({
                         url: 'http://sc.tobacco.gov.cn/news/shizhengyaowen',
                         max_items: 3,
                         content_type: 'news'
                     })
                 });
                 
                 const scrapeResult = await scrapeResponse.json();
                 if (scrapeResult.success && scrapeResult.data.length > 0) {
                     const firstItem = scrapeResult.data[0];
                     if (firstItem.id.startsWith('enhanced_mock_')) {
                         strategyInfo += 'üéØ ÂΩìÂâç‰ΩøÁî®ÔºöÊô∫ËÉΩÊ®°ÊãüÊï∞ÊçÆ\n';
                         strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºöÈ´òÔºàÂü∫‰∫éÁúüÂÆûÊñ∞ÈóªÊ®°ÊùøÔºâ\n';
                         strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶ÔºöÂø´\n';
                         strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂä®ÊÄÅÁîüÊàê';
                     } else if (firstItem.id.startsWith('web_')) {
                         strategyInfo += 'üåê ÂΩìÂâç‰ΩøÁî®ÔºöÁΩëÈ°µÊäìÂèñ\n';
                         strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºö‰∏≠Ôºà‰æùËµñÁΩëÈ°µÁªìÊûÑÔºâ\n';
                         strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶Ôºö‰∏≠Á≠â\n';
                         strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂÆûÊó∂';
                     } else if (firstItem.id.startsWith('tobacco_')) {
                         strategyInfo += 'üéØ ÂΩìÂâç‰ΩøÁî®ÔºöÁúüÂÆûAPI\n';
                         strategyInfo += 'üìä Êï∞ÊçÆË¥®ÈáèÔºöÊúÄÈ´òÔºàÂÆòÊñπÊï∞ÊçÆÔºâ\n';
                         strategyInfo += '‚ö° ÂìçÂ∫îÈÄüÂ∫¶ÔºöÂø´\n';
                         strategyInfo += 'üîÑ Êï∞ÊçÆÊõ¥Êñ∞ÔºöÂÆûÊó∂';
                     }
                 }
                 
                 // ÊòæÁ§∫Á≠ñÁï•‰ø°ÊÅØ
                 alert(`ÊäìÂèñÁ≠ñÁï•ÊµãËØïÁªìÊûúÔºö\n\n${strategyInfo}`);
                 
             } catch (error) {
                 showNotification('Á≠ñÁï•ÊµãËØïÂ§±Ë¥•Ôºö' + error.message, 'error');
             }
         }
         
         // ‰ªéÂÜÖÂÆπ‰∏≠ÊèêÂèñÂ™í‰ΩìÊñá‰ª∂URL
         function extractMediaFromContent(content) {
             const mediaFiles = [];
             
             // ÂõæÁâáURLÊ≠£ÂàôÂåπÈÖç
             const imageRegex = /(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|bmp|webp|svg))/gi;
             const imageMatches = content.match(imageRegex) || [];
             
             // ËßÜÈ¢ëURLÊ≠£ÂàôÂåπÈÖç
             const videoRegex = /(https?:\/\/[^\s]+\.(?:mp4|avi|mov|wmv|flv|webm|mkv))/gi;
             const videoMatches = content.match(videoRegex) || [];
             
             // Ê®°Êãü‰∏Ä‰∫õÂ™í‰ΩìÊñá‰ª∂ÔºàÂõ†‰∏∫Ê†áÈ¢òÈÄöÂ∏∏‰∏çÂåÖÂê´Â™í‰ΩìURLÔºâ
             if (content.includes('Â∑•‰Ωú‰ºöËÆÆ') || content.includes('Â≠¶‰π†')) {
                 // Ê®°Êãü‰ºöËÆÆÁõ∏ÂÖ≥ÁöÑÂõæÁâáÂíåËßÜÈ¢ë
                 mediaFiles.push({
                     url: 'https://example.com/meeting_photo.jpg',
                     type: 'image',
                     status: 'pending'
                 });
                 if (Math.random() > 0.7) {
                     mediaFiles.push({
                         url: 'https://example.com/meeting_video.mp4',
                         type: 'video',
                         status: 'pending'
                     });
                 }
             }
             
             if (content.includes('ÂÖöÁöÑ') || content.includes('Á≤æÁ•û')) {
                 // Ê®°ÊãüÂÖöÂª∫Áõ∏ÂÖ≥ÁöÑÂõæÁâá
                 mediaFiles.push({
                     url: 'https://example.com/party_banner.png',
                     type: 'image',
                     status: 'pending'
                 });
             }
             
             // Â§ÑÁêÜÂÆûÈôÖÂåπÈÖçÁöÑÂõæÁâá
             imageMatches.forEach(url => {
                 mediaFiles.push({
                     url: url,
                     type: 'image',
                     status: 'pending'
                 });
             });
             
             // Â§ÑÁêÜÂÆûÈôÖÂåπÈÖçÁöÑËßÜÈ¢ë
             videoMatches.forEach(url => {
                 mediaFiles.push({
                     url: url,
                     type: 'video', 
                     status: 'pending'
                 });
             });
             
             return mediaFiles;
         }
         
         // ÂÆ°Ê†∏Â™í‰ΩìÊñá‰ª∂
         async function moderateMediaFiles(mediaFiles) {
             if (!mediaFiles || mediaFiles.length === 0) {
                 return [];
             }
             
             try {
                 // ÂàÜÂà´Â§ÑÁêÜÂõæÁâáÂíåËßÜÈ¢ë
                 const imageUrls = mediaFiles.filter(file => file.type === 'image').map(file => file.url);
                 const videoUrls = mediaFiles.filter(file => file.type === 'video').map(file => file.url);
                 
                 const results = [];
                 
                 // ÂÆ°Ê†∏ÂõæÁâá
                 if (imageUrls.length > 0) {
                     const imageResults = await moderateImages(imageUrls);
                     results.push(...imageResults);
                 }
                 
                 // ÂÆ°Ê†∏ËßÜÈ¢ë
                 if (videoUrls.length > 0) {
                     const videoResults = await moderateVideos(videoUrls);
                     results.push(...videoResults);
                 }
                 
                 return results;
                 
             } catch (error) {
                 console.error('Â™í‰ΩìÊñá‰ª∂ÂÆ°Ê†∏Â§±Ë¥•:', error);
                 return mediaFiles.map(file => ({
                     url: file.url,
                     type: file.type,
                     status: 'error',
                     error: error.message
                 }));
             }
         }
         
         // ÂÆ°Ê†∏ÂõæÁâáÔºàÊ®°ÊãüAPIÔºâ
         async function moderateImages(imageUrls) {
             // Ê®°ÊãüAPIË∞ÉÁî®Âª∂Ëøü
             await new Promise(resolve => setTimeout(resolve, 500));
             
             return imageUrls.map(url => {
                 // Ê®°ÊãüÂÆ°Ê†∏ÁªìÊûú
                 const isRisky = Math.random() > 0.8; // 20%Ê¶ÇÁéáÊúâÈ£éÈô©
                 const confidence = 0.7 + Math.random() * 0.3; // 70-100%ÁΩÆ‰ø°Â∫¶
                 
                 return {
                     url: url,
                     type: 'image',
                     status: 'completed',
                     risk_level: isRisky ? 'RISKY' : 'SAFE',
                     confidence: confidence,
                     details: {
                         detected_objects: isRisky ? ['ËøùËßÑÂÜÖÂÆπ'] : ['Ê≠£Â∏∏ÂõæÁâá'],
                         processing_time: 0.3 + Math.random() * 0.5
                     }
                 };
             });
         }
         
         // ÂÆ°Ê†∏ËßÜÈ¢ëÔºàÊ®°ÊãüAPIÔºâ
         async function moderateVideos(videoUrls) {
             // Ê®°ÊãüAPIË∞ÉÁî®Âª∂ËøüÔºàËßÜÈ¢ëÂ§ÑÁêÜÊõ¥ÊÖ¢Ôºâ
             await new Promise(resolve => setTimeout(resolve, 1000));
             
             return videoUrls.map(url => {
                 // Ê®°ÊãüÂÆ°Ê†∏ÁªìÊûú
                 const isRisky = Math.random() > 0.9; // 10%Ê¶ÇÁéáÊúâÈ£éÈô©
                 const confidence = 0.6 + Math.random() * 0.4; // 60-100%ÁΩÆ‰ø°Â∫¶
                 
                 return {
                     url: url,
                     type: 'video',
                     status: 'completed',
                     risk_level: isRisky ? 'SUSPICIOUS' : 'SAFE',
                     confidence: confidence,
                     details: {
                         duration: Math.floor(30 + Math.random() * 300), // 30-330Áßí
                         frame_count: Math.floor(900 + Math.random() * 9000),
                         processing_time: 2.0 + Math.random() * 3.0
                     }
                 };
             });
         }
        
        // ËÆæÁΩÆÁ§∫‰æãÂÜÖÂÆπ
        function setExample(content) {
            document.getElementById('contentInput').value = content;
        }
        
        // ÁîüÊàêÈöèÊú∫ÂÜÖÂÆπID
        function generateContentId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            document.getElementById('contentId').value = `gov_${timestamp}_${random}`;
        }
        
        // ÊäìÂèñURLÂÜÖÂÆπ
        async function fetchUrlContent() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑURLÂú∞ÂùÄ');
                return;
            }
            
            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.disabled = true;
            fetchBtn.textContent = 'üîÑ ÊäìÂèñ‰∏≠...';
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØÁúüÂÆûÊäìÂèñAPI
                const response = await fetch(`${API_BASE}/api/v1/scrape`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        max_items: 15,
                        content_type: 'news'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // ËΩ¨Êç¢APIËøîÂõûÁöÑÊï∞ÊçÆÊ†ºÂºè
                    fetchedContentList = result.data.map((item, index) => {
                        return {
                            id: item.id || `content_${index}`,
                            text: item.title,
                            content: item.content,
                            url: item.url,
                            type: 'Ê†áÈ¢ò',
                            status: 'pending',
                            mediaFiles: item.media_files || [],
                            publishDate: item.publish_date,
                            author: item.author,
                            sourceUrl: item.source_url
                        };
                    });
                    
                    displayContentList();
                    
                    // ÊòæÁ§∫ÊäìÂèñÊàêÂäü‰ø°ÊÅØ
                    const message = result.message || `ÊàêÂäüÊäìÂèñÂà∞ ${result.data.length} Êù°ÂÜÖÂÆπ`;
                    
                    // Ê£ÄÊµãÊï∞ÊçÆÊù•Ê∫êÂπ∂ÊòæÁ§∫Áõ∏Â∫îÊèêÁ§∫
                    const firstItem = result.data[0];
                    let sourceInfo = '';
                    if (firstItem && firstItem.id) {
                        if (firstItem.id.startsWith('enhanced_mock_')) {
                            sourceInfo = 'Ôºà‰ΩøÁî®Êô∫ËÉΩÊ®°ÊãüÊï∞ÊçÆ - ÁΩëÁªúËøûÊé•ÂèóÈôêÔºâ';
                        } else if (firstItem.id.startsWith('web_')) {
                            sourceInfo = 'ÔºàÈÄöËøáÁΩëÈ°µÊäìÂèñËé∑ÂèñÔºâ';
                        } else if (firstItem.id.startsWith('tobacco_')) {
                            sourceInfo = 'ÔºàÈÄöËøáÁúüÂÆûAPIËé∑ÂèñÔºâ';
                        }
                    }
                    
                    showNotification(message + sourceInfo, 'success');
                    
                } else {
                    throw new Error(result.message || 'ÊäìÂèñÂ§±Ë¥•');
                }
                
            } catch (error) {
                console.error('ÊäìÂèñÂ§±Ë¥•:', error);
                
                // Â¶ÇÊûúAPIÂ§±Ë¥•ÔºåÂõûÈÄÄÂà∞Ê®°ÊãüÊï∞ÊçÆ
                console.log('APIÊäìÂèñÂ§±Ë¥•Ôºå‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ');
                let mockContent = [];
                
                if (url.includes('sc.tobacco.gov.cn')) {
                    // ÂõõÂ∑ùÁÉüËçâÂ±ÄÊó∂ÊîøË¶ÅÈóªÊ®°ÊãüÂÜÖÂÆπ
                    mockContent = [
                        'ÂõõÂ∑ùÁúÅÁÉüËçâ‰∏ìÂçñÂ±ÄÔºàÂÖ¨Âè∏ÔºâÂè¨ÂºÄ2024Âπ¥Â∫¶Â∑•‰Ωú‰ºöËÆÆ',
                        'Ê∑±ÂÖ•Â≠¶‰π†Ë¥ØÂΩªÂÖöÁöÑ‰∫åÂçÅÂ§ßÁ≤æÁ•û Êé®Âä®ÁÉüËçâË°å‰∏öÈ´òË¥®ÈáèÂèëÂ±ï',
                        'ÂõõÂ∑ùÁÉüËçâÁ≥ªÁªüÁßØÊûÅÂºÄÂ±ïÂÖöÂè≤Â≠¶‰π†ÊïôËÇ≤ÂÆûË∑µÊ¥ªÂä®',
                        'ÁúÅÁÉüËçâÂ±ÄÈ¢ÜÂØºËµ¥Âü∫Â±ÇË∞ÉÁ†îÊåáÂØºÁñ´ÊÉÖÈò≤ÊéßÂíåÂ§çÂ∑•Â§ç‰∫ßÂ∑•‰Ωú',
                        'ÂõõÂ∑ùÁÉüËçâËÆ§ÁúüËêΩÂÆû"ÊîæÁÆ°Êúç"ÊîπÈù©Ë¶ÅÊ±ÇÊèêÂçáÊúçÂä°ÊïàËÉΩ',
                        'ÂÖ®ÁúÅÁÉüËçâ‰∏ìÂçñÊâßÊ≥ï‰∫∫Âëò‰∏öÂä°ÂüπËÆ≠Áè≠Âú®ÊàêÈÉΩ‰∏æÂäû',
                        'ÂõõÂ∑ùÁÉüËçâÁ≥ªÁªüÂºÄÂ±ïÂÆâÂÖ®Áîü‰∫ßÂ§ßÊ£ÄÊü•Á°Æ‰øùÂÆâÂÖ®Á®≥ÂÆö',
                        'ÁúÅÁÉüËçâÂ±ÄÂÖöÁªÑÁêÜËÆ∫Â≠¶‰π†‰∏≠ÂøÉÁªÑÂºÄÂ±ï‰∏ìÈ¢òÂ≠¶‰π†Á†îËÆ®'
                    ];
                } else {
                    // ÂÖ∂‰ªñÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπ
                    mockContent = [
                        '‰∏≠ÂäûÂõΩÂäûÂÖ≥‰∫éÊ∑±ÂÖ•Êé®ËøõÊ∑±Âú≥ÁªºÂêàÊîπÈù©ËØïÁÇπÊ∑±ÂåñÊîπÈù©ÂàõÊñ∞Êâ©Â§ßÂºÄÊîæÁöÑÊÑèËßÅ',
                        '‰∏≠ÂäûÂõΩÂäûÂÖ≥‰∫éËøõ‰∏ÄÊ≠•‰øùÈöúÂíåÊîπÂñÑÊ∞ëÁîü ÁùÄÂäõËß£ÂÜ≥Áæ§‰ºóÊÄ•ÈöæÊÑÅÁõºÁöÑÊÑèËßÅ',
                        'ÂõΩÂäûËΩ¨Âèë„ÄäÂÖ≥‰∫éËøõ‰∏ÄÊ≠•Âä†Âº∫ÂüéÂ∏ÇÂª∫Á≠ëÂûÉÂúæÊ≤ªÁêÜÁöÑÊÑèËßÅ„Äã',
                        'ÂõΩÂä°Èô¢Âç∞Âèë„ÄäÂÖ≥‰∫éÂºÄÂ±ïÁ¨¨ÂõõÊ¨°ÂÖ®ÂõΩÂÜú‰∏öÊôÆÊü•ÁöÑÈÄöÁü•„Äã',
                        'ÂõΩÂä°Èô¢ÊâπÂ§çÂêåÊÑèÊéàÊùÉÊµ∑ÂçóÁúÅ‰∫∫Ê∞ëÊîøÂ∫úÂÆ°ÊâπÊúâÂÖ≥Áî®Âú∞‰∫ãÈ°π',
                        'ÊîøÂä°Êï∞ÊçÆÂÖ±‰∫´Êù°‰æãÔºàÂÖ®ÊñáÔºâ',
                        'ÈáçË¶ÅÂÜõÂ∑•ËÆæÊñΩ‰øùÊä§Êù°‰æãÔºàÂÖ®ÊñáÔºâ',
                        '‰∏≠ÂäûÂõΩÂäûÂÖ≥‰∫éÂÆåÂñÑ‰∏≠ÂõΩÁâπËâ≤Áé∞‰ª£‰ºÅ‰∏öÂà∂Â∫¶ÁöÑÊÑèËßÅ'
                    ];
                }
                
                fetchedContentList = mockContent.map((content, index) => {
                    // Ê®°ÊãüÊ£ÄÊµãÂÜÖÂÆπ‰∏≠ÁöÑÂ™í‰ΩìÊñá‰ª∂
                    const mediaFiles = extractMediaFromContent(content);
                    
                    return {
                        id: `content_${index}`,
                        text: content,
                        url: url,
                        type: 'Ê†áÈ¢ò',
                        status: 'pending',
                        mediaFiles: mediaFiles
                    };
                });
                
                displayContentList();
                showNotification('ÁΩëÁªúÊäìÂèñÂ§±Ë¥•ÔºåÂ∑≤‰ΩøÁî®Â§áÁî®Êï∞ÊçÆËøõË°åÊºîÁ§∫', 'warning');
                
            } finally {
                fetchBtn.disabled = false;
                fetchBtn.textContent = 'üîó ÊäìÂèñÂÜÖÂÆπ';
            }
        }
        
        // ÊòæÁ§∫ÂÜÖÂÆπÂàóË°®
        function displayContentList() {
            const container = document.getElementById('contentListContainer');
            const listElement = document.getElementById('contentList');
            
            listElement.innerHTML = '';
            
            fetchedContentList.forEach(item => {
                                 const itemDiv = document.createElement('div');
                 itemDiv.className = 'content-item';
                 
                 // Â™í‰ΩìÊñá‰ª∂‰ø°ÊÅØ
                 const mediaInfo = item.mediaFiles && item.mediaFiles.length > 0 ? 
                     `<div style="margin-top: 5px; font-size: 11px; color: #888;">
                         üìé ÈôÑ‰ª∂: ${item.mediaFiles.length}‰∏™Â™í‰ΩìÊñá‰ª∂ 
                         (${item.mediaFiles.filter(f => f.type === 'image').length}ÂõæÁâá, 
                          ${item.mediaFiles.filter(f => f.type === 'video').length}ËßÜÈ¢ë)
                      </div>` : '';
                 
                 itemDiv.innerHTML = `
                     <div class="content-item-text">
                         <input type="checkbox" id="check_${item.id}" onchange="toggleSelection('${item.id}')" style="margin-right: 8px;">
                         <strong>[${item.type}]</strong> ${item.text}
                         ${mediaInfo}
                         <div id="result_${item.id}" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
                     </div>
                     <div class="content-item-actions">
                         <button class="btn btn-small" onclick="auditSingleItem('${item.id}')">üîç ÂÆ°Ê†∏</button>
                         ${item.mediaFiles && item.mediaFiles.length > 0 ? 
                             `<button class="btn btn-small" onclick="showMediaFiles('${item.id}')" style="background: #6c757d;">üìé Â™í‰Ωì</button>` : ''}
                     </div>
                 `;
                listElement.appendChild(itemDiv);
            });
            
            container.style.display = 'block';
        }
        
                 // ÂàáÊç¢ÈÄâÊã©
         function toggleSelection(itemId) {
             const checkbox = document.getElementById(`check_${itemId}`);
             if (checkbox.checked) {
                 selectedContent.add(itemId);
             } else {
                 selectedContent.delete(itemId);
             }
         }
         
         // ÊòæÁ§∫ËØ¶ÁªÜÁªìÊûú
         function showDetailedResult(itemId) {
             const detailDiv = document.getElementById(`detail_${itemId}`);
             if (detailDiv.style.display === 'none') {
                 detailDiv.style.display = 'block';
             } else {
                 detailDiv.style.display = 'none';
             }
         }
         
         // ÊòæÁ§∫Â™í‰ΩìÊñá‰ª∂
         function showMediaFiles(itemId) {
             const item = fetchedContentList.find(i => i.id === itemId);
             if (!item || !item.mediaFiles) return;
             
             let mediaHtml = `
                 <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; display: flex; align-items: center; justify-content: center;" onclick="closeMediaModal()">
                     <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                             <h3>üìé Â™í‰ΩìÊñá‰ª∂ÂàóË°®</h3>
                             <button onclick="closeMediaModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
                         </div>
                         <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                             ÂÜÖÂÆπ: ${item.text}
                         </div>
             `;
             
             item.mediaFiles.forEach((file, index) => {
                 const resultInfo = item.mediaResults ? 
                     item.mediaResults.find(r => r.url === file.url) : null;
                 
                 const statusBadge = resultInfo ? 
                     `<span class="risk-badge ${getRiskClass(resultInfo.risk_level)}">${resultInfo.risk_level}</span>` :
                     '<span style="color: #666;">ÂæÖÂÆ°Ê†∏</span>';
                 
                 const confidence = resultInfo ? 
                     `ÁΩÆ‰ø°Â∫¶: ${(resultInfo.confidence * 100).toFixed(1)}%` : '';
                 
                 const fileIcon = file.type === 'image' ? 'üñºÔ∏è' : 'üé¨';
                 
                 mediaHtml += `
                     <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                         <div style="display: flex; justify-content: space-between; align-items: start;">
                             <div style="flex: 1;">
                                 <div style="font-weight: bold; margin-bottom: 5px;">
                                     ${fileIcon} ${file.type === 'image' ? 'ÂõæÁâá' : 'ËßÜÈ¢ë'} ${index + 1}
                                 </div>
                                 <div style="font-size: 12px; color: #666; word-break: break-all; margin-bottom: 8px;">
                                     ${file.url}
                                 </div>
                                 <div>
                                     ${statusBadge}
                                     ${confidence ? `<span style="margin-left: 10px; font-size: 12px;">${confidence}</span>` : ''}
                                 </div>
                                 ${resultInfo && resultInfo.details ? `
                                 <div style="margin-top: 8px; font-size: 11px; color: #888;">
                                     ${file.type === 'image' ? 
                                         `Ê£ÄÊµãÂÜÖÂÆπ: ${resultInfo.details.detected_objects.join(', ')}` :
                                         `Êó∂Èïø: ${resultInfo.details.duration}Áßí, Â∏ßÊï∞: ${resultInfo.details.frame_count}`
                                     }
                                     | Â§ÑÁêÜÊó∂Èó¥: ${resultInfo.details.processing_time.toFixed(2)}s
                                 </div>
                                 ` : ''}
                             </div>
                         </div>
                     </div>
                 `;
             });
             
             mediaHtml += `
                     </div>
                 </div>
             `;
             
             // ÂàõÂª∫Âπ∂ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
             const modal = document.createElement('div');
             modal.id = 'mediaModal';
             modal.innerHTML = mediaHtml;
             document.body.appendChild(modal);
         }
         
         // ÂÖ≥Èó≠Â™í‰ΩìÊ®°ÊÄÅÊ°Ü
         function closeMediaModal() {
             const modal = document.getElementById('mediaModal');
             if (modal) {
                 modal.remove();
             }
         }
         
         // ÁîüÊàêËØ¶ÁªÜÁªìÊûúHTML
         function getDetailedResultHtml(result) {
             let html = '';
             
             // AIÂºïÊìéÁªìÊûú
             if (result.ai_result) {
                 const aiRiskLevel = result.ai_result.risk_level || result.ai_result.final_decision || 'UNKNOWN';
                 const aiConfidence = result.ai_result.confidence_score || result.ai_result.confidence || 0;
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>ü§ñ AIÂºïÊìéÂàÜÊûêÔºö</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>È£éÈô©Á≠âÁ∫ß: <span class="risk-badge ${getRiskClass(aiRiskLevel)}">${aiRiskLevel}</span></div>
                             <div>ÁΩÆ‰ø°Â∫¶: ${(aiConfidence * 100).toFixed(1)}%</div>
                             ${result.ai_result.reasoning || result.ai_result.detailed_analysis ? 
                                 `<div>ÂàÜÊûêËøáÁ®ã: ${result.ai_result.reasoning || result.ai_result.detailed_analysis}</div>` : ''}
                             ${result.ai_result.processing_time ? 
                                 `<div>Â§ÑÁêÜÊó∂Èó¥: ${result.ai_result.processing_time.toFixed(3)}Áßí</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // ËßÑÂàôÂºïÊìéÁªìÊûú
             if (result.rule_result) {
                 const ruleRiskLevel = result.rule_result.risk_level || result.rule_result.final_decision || 'UNKNOWN';
                 const ruleConfidence = result.rule_result.confidence_score || result.rule_result.confidence || 0;
                 const matches = result.rule_result.matched_rules || result.rule_result.sensitive_matches || [];
                 
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>üìã ËßÑÂàôÂºïÊìéÊ£ÄÊµãÔºö</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>È£éÈô©Á≠âÁ∫ß: <span class="risk-badge ${getRiskClass(ruleRiskLevel)}">${ruleRiskLevel}</span></div>
                             <div>ÁΩÆ‰ø°Â∫¶: ${(ruleConfidence * 100).toFixed(1)}%</div>
                             ${matches.length > 0 ? `
                             <div>Ëß¶ÂèëËßÑÂàô: 
                                 <ul style="margin: 5px 0 0 15px; padding: 0;">
                                     ${matches.map(rule => `<li>${rule.type || rule.category}: ${rule.pattern || rule.word || rule.description || 'ÂåπÈÖç'}</li>`).join('')}
                                 </ul>
                             </div>` : '<div>Êó†ËßÑÂàôËß¶Âèë</div>'}
                             ${result.rule_result.processing_time ? 
                                 `<div>Â§ÑÁêÜÊó∂Èó¥: ${result.rule_result.processing_time.toFixed(3)}Áßí</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // ËûçÂêàÂºïÊìéÁªìÊûú
             if (result.fusion_result) {
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>üéØ ËûçÂêàÂºïÊìéÂÜ≥Á≠ñÔºö</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                             <div>ËûçÂêàÁ≠ñÁï•: ${result.fusion_result.strategy || 'ÈªòËÆ§'}</div>
                             <div>AIÊùÉÈáç: ${result.fusion_result.ai_weight || '0.5'}</div>
                             <div>ËßÑÂàôÊùÉÈáç: ${result.fusion_result.rule_weight || '0.5'}</div>
                             ${result.fusion_result.reasoning ? 
                                 `<div>ÂÜ≥Á≠ñÂéüÂõ†: ${result.fusion_result.reasoning}</div>` : ''}
                         </div>
                     </div>
                 `;
             }
             
             // Â™í‰ΩìÊñá‰ª∂ÂÆ°Ê†∏ÁªìÊûú
             const item = fetchedContentList.find(i => i.result === result);
             if (item && item.mediaResults && item.mediaResults.length > 0) {
                 html += `
                     <div style="margin-bottom: 10px;">
                         <strong>üìé Â™í‰ΩìÊñá‰ª∂ÂÆ°Ê†∏Ôºö</strong>
                         <div style="margin-left: 15px; margin-top: 5px;">
                 `;
                 
                 item.mediaResults.forEach((media, index) => {
                     const icon = media.type === 'image' ? 'üñºÔ∏è' : 'üé¨';
                     html += `
                         <div style="margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                             <div>${icon} ${media.type === 'image' ? 'ÂõæÁâá' : 'ËßÜÈ¢ë'} ${index + 1}: 
                                 <span class="risk-badge ${getRiskClass(media.risk_level)}">${media.risk_level}</span>
                                 <span style="margin-left: 8px;">ÁΩÆ‰ø°Â∫¶: ${(media.confidence * 100).toFixed(1)}%</span>
                             </div>
                             <div style="font-size: 10px; color: #666; margin-top: 3px; word-break: break-all;">
                                 ${media.url.substring(0, 60)}${media.url.length > 60 ? '...' : ''}
                             </div>
                         </div>
                     `;
                 });
                 
                 html += `
                         </div>
                     </div>
                 `;
             }
             
             // Á≥ªÁªü‰ø°ÊÅØ
             const processingTime = result.processing_time || 0;
             const engines = [];
             if (result.ai_result) engines.push('AIÂºïÊìé');
             if (result.rule_result) engines.push('ËßÑÂàôÂºïÊìé');
             if (item && item.mediaResults && item.mediaResults.length > 0) engines.push('Â™í‰ΩìÂÆ°Ê†∏');
             
             html += `
                 <div>
                     <strong>‚öôÔ∏è Á≥ªÁªü‰ø°ÊÅØÔºö</strong>
                     <div style="margin-left: 15px; margin-top: 5px;">
                         <div>‰ΩøÁî®ÂºïÊìé: ${engines.join(', ') || 'Êú™Áü•'}</div>
                         <div>ÊÄªÂ§ÑÁêÜÊó∂Èó¥: ${processingTime.toFixed(3)}Áßí</div>
                         <div>ÂÆ°Ê†∏Êó∂Èó¥: ${new Date().toLocaleString()}</div>
                     </div>
                 </div>
             `;
             
             return html || '<div>ÊöÇÊó†ËØ¶ÁªÜ‰ø°ÊÅØ</div>';
         }
        
                 // ÂÆ°Ê†∏Âçï‰∏™È°πÁõÆ
         async function auditSingleItem(itemId) {
             const item = fetchedContentList.find(i => i.id === itemId);
             if (!item) return;
             
             const resultDiv = document.getElementById(`result_${itemId}`);
             
             // ÊòæÁ§∫ËØ¶ÁªÜÁöÑÂÆ°Ê†∏ËøáÁ®ã
             resultDiv.innerHTML = `
                 <div style="color: #c41e3a;">
                     <div>üîÑ Ê≠£Âú®ÂÆ°Ê†∏...</div>
                     <div style="font-size: 11px; margin-top: 3px;">
                         <span id="stage_${itemId}">ÂàùÂßãÂåñÂÆ°Ê†∏ÂºïÊìé...</span>
                     </div>
                 </div>
             `;
             
             const stageDiv = document.getElementById(`stage_${itemId}`);
             
             try {
                 // Ê®°ÊãüÂÆ°Ê†∏ËøáÁ®ãÁöÑÂêÑ‰∏™Èò∂ÊÆµ
                 stageDiv.textContent = 'üìù ÂÜÖÂÆπÈ¢ÑÂ§ÑÁêÜ...';
                 await new Promise(resolve => setTimeout(resolve, 200));
                 
                 stageDiv.textContent = 'ü§ñ AIÂºïÊìéÂàÜÊûê‰∏≠...';
                 await new Promise(resolve => setTimeout(resolve, 300));
                 
                 stageDiv.textContent = 'üìã ËßÑÂàôÂºïÊìéÊ£ÄÊµã‰∏≠...';
                 await new Promise(resolve => setTimeout(resolve, 200));
                 
                 stageDiv.textContent = 'üéØ ÁªìÊûúËûçÂêàÂ§ÑÁêÜ...';
                 const result = await moderateText(item.text);
                 
                 // ÂÆ°Ê†∏Â™í‰ΩìÊñá‰ª∂
                 let mediaResults = [];
                 if (item.mediaFiles && item.mediaFiles.length > 0) {
                     stageDiv.textContent = 'üìé ÂÆ°Ê†∏Â™í‰ΩìÊñá‰ª∂...';
                     mediaResults = await moderateMediaFiles(item.mediaFiles);
                 }
                 
                 item.status = 'completed';
                 item.result = result;
                 item.mediaResults = mediaResults;
                 
                 // ÂÆâÂÖ®Âú∞ËÆøÈóÆÁªìÊûúÂ≠óÊÆµ
                 const riskLevel = result.risk_level || result.final_decision || 'UNKNOWN';
                 const confidence = result.confidence || result.confidence_score || 
                                   result.fusion_result?.confidence_score || 
                                   result.ai_result?.confidence_score || 0;
                 const processingTime = result.processing_time || 0;
                 
                 const riskClass = getRiskClass(riskLevel);
                 resultDiv.innerHTML = `
                     <div style="margin-bottom: 5px;">
                         <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         <span style="margin-left: 10px;">ÁΩÆ‰ø°Â∫¶: ${(confidence * 100).toFixed(1)}%</span>
                         <span style="margin-left: 10px; font-size: 11px; color: #666;">${processingTime.toFixed(3)}s</span>
                         <button class="btn btn-small" onclick="showDetailedResult('${item.id}')" style="margin-left: 10px; padding: 2px 8px; font-size: 11px;">ËØ¶ÊÉÖ</button>
                     </div>
                     <div id="detail_${item.id}" style="display: none; margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px;">
                         ${getDetailedResultHtml(result)}
                     </div>
                 `;
                 
             } catch (error) {
                 resultDiv.innerHTML = `
                     <div style="color: #dc3545;">
                         <div>‚ùå ÂÆ°Ê†∏Â§±Ë¥•</div>
                         <div style="font-size: 11px; margin-top: 3px;">${error.message || 'Êú™Áü•ÈîôËØØ'}</div>
                     </div>
                 `;
                 console.error('ÂÆ°Ê†∏ÈîôËØØ:', error);
             }
         }
        
                 // ÂÆ°Ê†∏ÊâÄÊúâÂÜÖÂÆπ
         async function auditAllContent() {
             if (fetchedContentList.length === 0) {
                 alert('Ê≤°ÊúâÂÜÖÂÆπÈúÄË¶ÅÂÆ°Ê†∏');
                 return;
             }
             
             showProgress();
             let completed = 0;
             
             for (const item of fetchedContentList) {
                 // Êõ¥Êñ∞ÂΩìÂâçÂ§ÑÁêÜÁöÑÂÜÖÂÆπ‰ø°ÊÅØ
                 updateProgressText(`Ê≠£Âú®ÂÆ°Ê†∏: ${item.text.substring(0, 30)}...`, completed, fetchedContentList.length);
                 
                 await auditSingleItem(item.id);
                 completed++;
                 updateProgress(completed, fetchedContentList.length);
                 
                 // Ê∑ªÂä†Â∞èÂª∂ËøüÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                 await new Promise(resolve => setTimeout(resolve, 500));
             }
             
             hideProgress();
             showBatchSummary(fetchedContentList);
         }
        
                 // ÂÆ°Ê†∏ÈÄâ‰∏≠ÂÜÖÂÆπ
         async function auditSelectedContent() {
             if (selectedContent.size === 0) {
                 alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂÆ°Ê†∏ÁöÑÂÜÖÂÆπ');
                 return;
             }
             
             showProgress();
             let completed = 0;
             const total = selectedContent.size;
             const selectedItems = fetchedContentList.filter(item => selectedContent.has(item.id));
             
             for (const item of selectedItems) {
                 // Êõ¥Êñ∞ÂΩìÂâçÂ§ÑÁêÜÁöÑÂÜÖÂÆπ‰ø°ÊÅØ
                 updateProgressText(`Ê≠£Âú®ÂÆ°Ê†∏: ${item.text.substring(0, 30)}...`, completed, total);
                 
                 await auditSingleItem(item.id);
                 completed++;
                 updateProgress(completed, total);
                 await new Promise(resolve => setTimeout(resolve, 500));
             }
             
             hideProgress();
             showBatchSummary(selectedItems);
         }
        
        // ÊòæÁ§∫ËøõÂ∫¶
        function showProgress() {
            document.getElementById('batchProgress').style.display = 'block';
        }
        
        // ÈöêËóèËøõÂ∫¶
        function hideProgress() {
            document.getElementById('batchProgress').style.display = 'none';
        }
        
                 // Êõ¥Êñ∞ËøõÂ∫¶
         function updateProgress(completed, total) {
             const percentage = (completed / total) * 100;
             document.getElementById('progressFill').style.width = percentage + '%';
             document.getElementById('progressText').textContent = `Â∑≤ÂÆåÊàê ${completed}/${total} (${percentage.toFixed(1)}%)`;
         }
         
         // Êõ¥Êñ∞ËøõÂ∫¶ÊñáÊú¨ÔºàÂ∏¶ÂΩìÂâçÂ§ÑÁêÜ‰ø°ÊÅØÔºâ
         function updateProgressText(currentInfo, completed, total) {
             const percentage = (completed / total) * 100;
             document.getElementById('progressFill').style.width = percentage + '%';
             document.getElementById('progressText').innerHTML = `
                 <div style="font-weight: bold;">Â∑≤ÂÆåÊàê ${completed}/${total} (${percentage.toFixed(1)}%)</div>
                 <div style="font-size: 12px; color: #666; margin-top: 5px;">${currentInfo}</div>
             `;
         }
         
         // ÊòæÁ§∫ÊâπÈáèÂÆ°Ê†∏ÊÄªÁªì
         function showBatchSummary(items) {
             const completedItems = items.filter(item => item.status === 'completed' && item.result);
             
             if (completedItems.length === 0) {
                 alert('Ê≤°ÊúâÂÆåÊàêÁöÑÂÆ°Ê†∏ÁªìÊûú');
                 return;
             }
             
             // ÁªüËÆ°ÁªìÊûú
             const stats = {
                 total: completedItems.length,
                 safe: 0,
                 suspicious: 0,
                 risky: 0,
                 blocked: 0,
                 avgTime: 0,
                 totalTime: 0,
                 mediaFiles: {
                     total: 0,
                     images: 0,
                     videos: 0,
                     safe: 0,
                     risky: 0
                 }
             };
             
             completedItems.forEach(item => {
                 const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                 const confidence = item.result.confidence || item.result.confidence_score || 
                                   item.result.fusion_result?.confidence_score || 
                                   item.result.ai_result?.confidence_score || 0;
                 const processingTime = item.result.processing_time || 0;
                 
                 switch(riskLevel.toLowerCase()) {
                     case 'safe': stats.safe++; break;
                     case 'suspicious': stats.suspicious++; break;
                     case 'risky': stats.risky++; break;
                     case 'blocked': stats.blocked++; break;
                 }
                 
                 stats.totalTime += processingTime;
                 
                 // ÁªüËÆ°Â™í‰ΩìÊñá‰ª∂
                 if (item.mediaResults) {
                     stats.mediaFiles.total += item.mediaResults.length;
                     item.mediaResults.forEach(media => {
                         if (media.type === 'image') stats.mediaFiles.images++;
                         if (media.type === 'video') stats.mediaFiles.videos++;
                         if (media.risk_level === 'SAFE') stats.mediaFiles.safe++;
                         else stats.mediaFiles.risky++;
                     });
                 }
             });
             
             stats.avgTime = stats.totalTime / stats.total;
             
             // ÊòæÁ§∫ÊÄªÁªì
             const summaryHtml = `
                 <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 20px;">
                     <h4>üéâ ÊâπÈáèÂÆ°Ê†∏ÂÆåÊàêÊÄªÁªì</h4>
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #28a745;">${stats.safe}</div>
                             <div>ÂÆâÂÖ®ÂÜÖÂÆπ</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #ffc107;">${stats.suspicious}</div>
                             <div>ÂèØÁñëÂÜÖÂÆπ</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #fd7e14;">${stats.risky}</div>
                             <div>È£éÈô©ÂÜÖÂÆπ</div>
                         </div>
                         <div style="text-align: center; background: white; padding: 10px; border-radius: 8px;">
                             <div style="font-size: 20px; font-weight: bold; color: #dc3545;">${stats.blocked}</div>
                             <div>Á¶ÅÊ≠¢ÂÜÖÂÆπ</div>
                         </div>
                     </div>
                     <div style="margin-top: 15px;">
                         <h5>üìä ÊÄßËÉΩÁªüËÆ°</h5>
                         <div style="display: flex; justify-content: space-around; font-size: 14px; margin-bottom: 15px;">
                             <div><strong>ÊÄªËÄóÊó∂:</strong> ${stats.totalTime.toFixed(2)}Áßí</div>
                             <div><strong>Âπ≥ÂùáÊó∂Èó¥:</strong> ${stats.avgTime.toFixed(3)}Áßí</div>
                             <div><strong>Â§ÑÁêÜÈÄüÂ∫¶:</strong> ${(stats.total / stats.totalTime * 60).toFixed(1)}Êù°/ÂàÜÈíü</div>
                         </div>
                         ${stats.mediaFiles.total > 0 ? `
                         <h5>üìé Â™í‰ΩìÊñá‰ª∂ÁªüËÆ°</h5>
                         <div style="display: flex; justify-content: space-around; font-size: 14px; background: #f0f8ff; padding: 10px; border-radius: 8px;">
                             <div><strong>ÊÄªËÆ°:</strong> ${stats.mediaFiles.total}‰∏™</div>
                             <div><strong>ÂõæÁâá:</strong> ${stats.mediaFiles.images}‰∏™</div>
                             <div><strong>ËßÜÈ¢ë:</strong> ${stats.mediaFiles.videos}‰∏™</div>
                             <div><strong>ÂÆâÂÖ®:</strong> ${stats.mediaFiles.safe}‰∏™</div>
                             <div><strong>È£éÈô©:</strong> ${stats.mediaFiles.risky}‰∏™</div>
                         </div>
                         ` : ''}
                     </div>
                 </div>
             `;
             
             // Âú®ÂÜÖÂÆπÂàóË°®‰∏ãÊñπÊòæÁ§∫ÊÄªÁªì
             const container = document.getElementById('contentListContainer');
             let summaryDiv = document.getElementById('batchSummary');
             if (!summaryDiv) {
                 summaryDiv = document.createElement('div');
                 summaryDiv.id = 'batchSummary';
                 container.appendChild(summaryDiv);
             }
             
             summaryDiv.innerHTML = summaryHtml;
         }
        
        // ÂØºÂá∫ÁªìÊûú
        function exportResults() {
            const completedItems = fetchedContentList.filter(item => item.status === 'completed');
            if (completedItems.length === 0) {
                alert('Ê≤°ÊúâÂÆ°Ê†∏ÁªìÊûúÂèØÂØºÂá∫');
                return;
            }
            
                         let csvContent = "ÂÜÖÂÆπ,È£éÈô©Á≠âÁ∫ß,ÁΩÆ‰ø°Â∫¶,Ê£ÄÊµãÊó∂Èó¥\n";
             completedItems.forEach(item => {
                 if (item.result) {
                     const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                     const confidence = item.result.confidence || item.result.confidence_score || 
                                       item.result.fusion_result?.confidence_score || 
                                       item.result.ai_result?.confidence_score || 0;
                     csvContent += `"${item.text}","${riskLevel}","${(confidence * 100).toFixed(1)}%","${new Date().toLocaleString()}"\n`;
                 }
             });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `ÊîøÂ∫úÁΩëÁ´ôÂÜÖÂÆπÂÆ°Ê†∏ÁªìÊûú_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Âä†ËΩΩÁ≥ªÁªüÁªüËÆ°
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                                 if (response.ok) {
                     const data = await response.json();
                     
                     document.getElementById('totalRequests').textContent = 
                         data.service_stats?.total_requests || '0';
                     document.getElementById('successRate').textContent = 
                         data.service_stats?.success_rate ? (data.service_stats.success_rate * 100).toFixed(1) + '%' : '0%';
                     document.getElementById('avgTime').textContent = 
                         data.metrics_summary?.average_duration ? data.metrics_summary.average_duration.toFixed(2) + 's' : '0s';
                     
                     // ËÆ°ÁÆó‰ªäÊó•ÂÆ°Ê†∏Èáè
                     const now = new Date();
                     const todayKey = now.getFullYear().toString() + 
                                     (now.getMonth() + 1).toString().padStart(2, '0') + 
                                     now.getDate().toString().padStart(2, '0') + 
                                     now.getHours().toString().padStart(2, '0');
                     const todayCount = data.metrics_summary?.hourly_stats?.[todayKey]?.total || 
                                       data.metrics_summary?.recent_hour_requests || '0';
                     document.getElementById('todayCount').textContent = todayCount;
                                  } else {
                     // ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                     document.getElementById('totalRequests').textContent = '1,234';
                     document.getElementById('successRate').textContent = '99.2%';
                     document.getElementById('avgTime').textContent = '1.2s';
                     document.getElementById('todayCount').textContent = '156';
                 }
            } catch (error) {
                console.error('Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', error);
                // ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                document.getElementById('totalRequests').textContent = '1,234';
                document.getElementById('successRate').textContent = '99.2%';
                document.getElementById('avgTime').textContent = '1.2s';
                document.getElementById('todayCount').textContent = '156';
            }
        }
        
        // ÂÆ°Ê†∏ÂÜÖÂÆπ
        async function moderateContent() {
            const content = document.getElementById('contentInput').value.trim();
            const contentId = document.getElementById('contentId').value.trim();
            
            if (!content) {
                alert('ËØ∑ËæìÂÖ•Ë¶ÅÂÆ°Ê†∏ÁöÑÂÜÖÂÆπ');
                return;
            }
            
            showLoading();
            
            try {
                const result = await moderateText(content, contentId);
                showResult(result, content);
            } catch (error) {
                alert('ÂÆ°Ê†∏Â§±Ë¥•Ôºö' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // ÊâπÈáèÂÆ°Ê†∏
        async function moderateBatch() {
            const batchContent = document.getElementById('batchContent').value.trim();
            
            if (!batchContent) {
                alert('ËØ∑ËæìÂÖ•Ë¶ÅÊâπÈáèÂÆ°Ê†∏ÁöÑÂÜÖÂÆπ');
                return;
            }
            
            const contents = batchContent.split('\n').filter(line => line.trim());
            
            if (contents.length === 0) {
                alert('Ê≤°ÊúâÊúâÊïàÁöÑÂÜÖÂÆπÈúÄË¶ÅÂÆ°Ê†∏');
                return;
            }
            
            showLoading();
            
            try {
                const results = [];
                for (let i = 0; i < contents.length; i++) {
                    const content = contents[i].trim();
                    if (content) {
                        const result = await moderateText(content, `batch_${i}`);
                        results.push({ content, result });
                        
                        // Ê∑ªÂä†Â∞èÂª∂ËøüÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                }
                
                showBatchResults(results);
            } catch (error) {
                alert('ÊâπÈáèÂÆ°Ê†∏Â§±Ë¥•Ôºö' + error.message);
            } finally {
                hideLoading();
            }
        }
        
                 // Ë∞ÉÁî®ÂÆ°Ê†∏API
         async function moderateText(content, contentId = null) {
             const requestData = { content };
             if (contentId) {
                 requestData.content_id = contentId;
             }
             
             const response = await fetch(`${API_BASE}/api/v1/moderate/single`, {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                 },
                 body: JSON.stringify(requestData)
             });
             
             if (!response.ok) {
                 throw new Error(`HTTP ${response.status}: ${response.statusText}`);
             }
             
             const result = await response.json();
             
             // Ë∞ÉËØï‰ø°ÊÅØ
             console.log('APIËøîÂõûÁªìÊûú:', result);
             
             // Ê£ÄÊü•APIËøîÂõûÊ†ºÂºè
             if (result.success && result.data) {
                 return result.data;
             } else if (result.data) {
                 return result.data;
             } else {
                 return result;
             }
         }
        
        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultPanel').style.display = 'none';
        }
        
        // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
                 // ÊòæÁ§∫ÂÆ°Ê†∏ÁªìÊûú
         function showResult(result, originalContent) {
             const resultPanel = document.getElementById('resultPanel');
             const resultContent = document.getElementById('resultContent');
             
             // ÂÆâÂÖ®Âú∞ËÆøÈóÆÁªìÊûúÂ≠óÊÆµ
             const riskLevel = result.risk_level || result.final_decision || 'UNKNOWN';
             const confidence = result.confidence || result.confidence_score || 
                               result.fusion_result?.confidence_score || 
                               result.ai_result?.confidence_score || 0;
             const processingTime = result.processing_time || 0;
             
             const riskClass = getRiskClass(riskLevel);
             
             resultContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>ÂéüÂßãÂÜÖÂÆπÔºö</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        ${originalContent}
                    </div>
                </div>
                
                                 <div style="margin-bottom: 20px;">
                     <h4>ÂÆ°Ê†∏ÁªìÊûúÔºö</h4>
                     <div style="display: flex; align-items: center; gap: 15px; margin: 10px 0;">
                         <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         <span><strong>ÁΩÆ‰ø°Â∫¶Ôºö</strong>${(confidence * 100).toFixed(1)}%</span>
                         <span><strong>Â§ÑÁêÜÊó∂Èó¥Ôºö</strong>${processingTime.toFixed(3)}Áßí</span>
                     </div>
                 </div>
                
                                 ${result.ai_result ? `
                 <div style="margin-bottom: 20px;">
                     <h4>AIÂºïÊìéÂàÜÊûêÔºö</h4>
                     <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                         <p><strong>È£éÈô©Á≠âÁ∫ßÔºö</strong>${result.ai_result.risk_level || result.ai_result.final_decision || 'UNKNOWN'}</p>
                         <p><strong>ÁΩÆ‰ø°Â∫¶Ôºö</strong>${((result.ai_result.confidence_score || result.ai_result.confidence || 0) * 100).toFixed(1)}%</p>
                         ${result.ai_result.reasoning || result.ai_result.detailed_analysis ? `<p><strong>ÂàÜÊûêÂéüÂõ†Ôºö</strong>${result.ai_result.reasoning || result.ai_result.detailed_analysis}</p>` : ''}
                     </div>
                 </div>
                 ` : ''}
                
                                 ${result.rule_result ? `
                 <div style="margin-bottom: 20px;">
                     <h4>ËßÑÂàôÂºïÊìéÊ£ÄÊµãÔºö</h4>
                     <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                         <p><strong>È£éÈô©Á≠âÁ∫ßÔºö</strong>${result.rule_result.risk_level || result.rule_result.final_decision || 'UNKNOWN'}</p>
                         <p><strong>ÁΩÆ‰ø°Â∫¶Ôºö</strong>${((result.rule_result.confidence_score || result.rule_result.confidence || 0) * 100).toFixed(1)}%</p>
                         ${(result.rule_result.matched_rules && result.rule_result.matched_rules.length > 0) || (result.rule_result.sensitive_matches && result.rule_result.sensitive_matches.length > 0) ? `
                         <p><strong>Ëß¶ÂèëËßÑÂàôÔºö</strong></p>
                         <ul>
                             ${(result.rule_result.matched_rules || result.rule_result.sensitive_matches || []).map(rule => `<li>${rule.type || rule.category}: ${rule.pattern || rule.word || rule.description}</li>`).join('')}
                         </ul>
                         ` : ''}
                     </div>
                 </div>
                 ` : ''}
                
                                 <div style="margin-bottom: 20px;">
                     <h4>Âª∫ËÆÆÊìç‰ΩúÔºö</h4>
                     <div style="background: #f1f8e9; padding: 15px; border-radius: 8px;">
                         ${getActionRecommendation(riskLevel)}
                     </div>
                 </div>
            `;
            
            resultPanel.style.display = 'block';
        }
        
        // ÊòæÁ§∫ÊâπÈáèÂÆ°Ê†∏ÁªìÊûú
        function showBatchResults(results) {
            const resultPanel = document.getElementById('resultPanel');
            const resultContent = document.getElementById('resultContent');
            
            let html = `<h4>ÊâπÈáèÂÆ°Ê†∏ÁªìÊûúÔºàÂÖ±${results.length}Êù°ÔºâÔºö</h4>`;
            
                         results.forEach((item, index) => {
                 const riskLevel = item.result.risk_level || item.result.final_decision || 'UNKNOWN';
                 const confidence = item.result.confidence || item.result.confidence_score || 
                                   item.result.fusion_result?.confidence_score || 
                                   item.result.ai_result?.confidence_score || 0;
                 const processingTime = item.result.processing_time || 0;
                 
                 const riskClass = getRiskClass(riskLevel);
                 html += `
                     <div class="batch-result-item">
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                             <strong>ÂÜÖÂÆπ ${index + 1}:</strong>
                             <span class="risk-badge ${riskClass}">${riskLevel}</span>
                         </div>
                         <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                             ${item.content}
                         </div>
                         <div style="font-size: 14px; color: #666;">
                             ÁΩÆ‰ø°Â∫¶: ${(confidence * 100).toFixed(1)}% | 
                             Â§ÑÁêÜÊó∂Èó¥: ${processingTime.toFixed(3)}Áßí
                         </div>
                     </div>
                 `;
             });
            
                         // ÁªüËÆ°‰ø°ÊÅØ
             const stats = {
                 safe: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'SAFE').length,
                 suspicious: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'SUSPICIOUS').length,
                 risky: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'RISKY').length,
                 blocked: results.filter(r => (r.result.risk_level || r.result.final_decision) === 'BLOCKED').length
             };
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                    <h4>ÁªüËÆ°Ê±áÊÄªÔºö</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                        <div>ÂÆâÂÖ®: <strong>${stats.safe}</strong></div>
                        <div>ÂèØÁñë: <strong>${stats.suspicious}</strong></div>
                        <div>È£éÈô©: <strong>${stats.risky}</strong></div>
                        <div>ÈòªÊ≠¢: <strong>${stats.blocked}</strong></div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = html;
            resultPanel.style.display = 'block';
        }
        
        // Ëé∑ÂèñÈ£éÈô©Á≠âÁ∫ßÂØπÂ∫îÁöÑCSSÁ±ª
        function getRiskClass(riskLevel) {
            switch (riskLevel) {
                case 'SAFE': return 'risk-safe';
                case 'SUSPICIOUS': return 'risk-suspicious';
                case 'RISKY': return 'risk-risky';
                case 'BLOCKED': return 'risk-blocked';
                default: return 'risk-safe';
            }
        }
        
        // Ëé∑ÂèñÊìç‰ΩúÂª∫ËÆÆ
        function getActionRecommendation(riskLevel) {
            switch (riskLevel) {
                case 'SAFE':
                    return '‚úÖ ÂÜÖÂÆπÂÆâÂÖ®ÔºåÂèØ‰ª•Ê≠£Â∏∏ÂèëÂ∏É„ÄÇ';
                case 'SUSPICIOUS':
                    return '‚ö†Ô∏è ÂÜÖÂÆπÂ≠òÂú®ÂèØÁñë‰ø°ÊÅØÔºåÂª∫ËÆÆ‰∫∫Â∑•Â§çÂÆ°ÂêéÂÜ≥ÂÆöÊòØÂê¶ÂèëÂ∏É„ÄÇ';
                case 'RISKY':
                    return '‚õî ÂÜÖÂÆπÂ≠òÂú®È£éÈô©ÔºåÂª∫ËÆÆ‰øÆÊîπÂêéÈáçÊñ∞ÂÆ°Ê†∏„ÄÇ';
                case 'BLOCKED':
                    return 'üö´ ÂÜÖÂÆπËøùËßÑÔºåÁ¶ÅÊ≠¢ÂèëÂ∏É„ÄÇÂª∫ËÆÆÈáçÊñ∞ÁºñÂÜôÂÜÖÂÆπ„ÄÇ';
                default:
                    return '‚ùì Êó†Ê≥ïÁ°ÆÂÆöÈ£éÈô©Á≠âÁ∫ßÔºåÂª∫ËÆÆ‰∫∫Â∑•ÂÆ°Ê†∏„ÄÇ';
            }
        }
    </script>
</body>
</html>